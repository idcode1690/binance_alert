{"ast":null,"code":"// Simple singleton scanner manager to run scans independent of React component lifecycle.\nconst scannerManager = (() => {\n  let running = false;\n  let currentSymbol = null;\n  let progress = {\n    done: 0,\n    total: 0\n  };\n  let results = [];\n  let cancel = false;\n  let listeners = new Set();\n  let getSymbolsFn = null;\n  function notify() {\n    const state = {\n      running,\n      currentSymbol,\n      progress: {\n        ...progress\n      },\n      results: results.slice()\n    };\n    for (const cb of listeners) {\n      try {\n        cb(state);\n      } catch (e) {}\n    }\n  }\n  function onUpdate(cb) {\n    listeners.add(cb);\n    return () => listeners.delete(cb);\n  }\n  function setGetSymbols(fn) {\n    getSymbolsFn = fn;\n  }\n  function sleep(ms) {\n    return new Promise(r => setTimeout(r, ms));\n  }\n\n  // same EMA helper as used in ScannerPage\n  function calculateEma(values, period) {\n    if (!Array.isArray(values) || values.length === 0) return [];\n    const k = 2 / (period + 1);\n    const out = [];\n    let ema = null;\n    for (let i = 0; i < values.length; i++) {\n      const v = Number(values[i]);\n      if (isNaN(v)) {\n        out.push(null);\n        continue;\n      }\n      if (ema === null) {\n        if (i + 1 >= period) {\n          const slice = values.slice(i + 1 - period, i + 1).map(Number);\n          const s = slice.reduce((a, b) => a + b, 0) / period;\n          ema = s;\n          out.push(ema);\n        } else {\n          out.push(null);\n        }\n      } else {\n        ema = v * k + ema * (1 - k);\n        out.push(ema);\n      }\n    }\n    return out;\n  }\n  async function start(type) {\n    if (running) return;\n    if (typeof getSymbolsFn !== 'function') throw new Error('scannerManager: getSymbolsFn not set');\n    running = true;\n    cancel = false;\n    results = [];\n    progress = {\n      done: 0,\n      total: 0\n    };\n    currentSymbol = null;\n    notify();\n    const list = (await Promise.resolve(getSymbolsFn())) || [];\n    const filtered = Array.isArray(list) ? list.filter(s => typeof s === 'string' && /USDT$/i.test(s)) : [];\n    progress.total = filtered.length;\n    notify();\n    const endpointBase = 'https://fapi.binance.com/fapi/v1/klines';\n    for (let i = 0; i < filtered.length; i++) {\n      if (cancel) break;\n      const sym = filtered[i];\n      currentSymbol = sym;\n      notify();\n      try {\n        const url = `${endpointBase}?symbol=${encodeURIComponent(sym)}&interval=5m&limit=500`;\n        const r = await fetch(url);\n        if (!r.ok) {\n          if (r.status === 429) await sleep(2000);\n          progress.done += 1;\n          notify();\n          await sleep(1000);\n          continue;\n        }\n        const data = await r.json();\n        const closes = Array.isArray(data) ? data.map(d => parseFloat(d[4])) : [];\n        if (!Array.isArray(closes) || closes.length < 210) {\n          progress.done += 1;\n          notify();\n          await sleep(1000);\n          continue;\n        }\n        const ema26 = calculateEma(closes, 26);\n        const ema200 = calculateEma(closes, 200);\n        const lastIdx = closes.length - 1;\n        const prevIdx = lastIdx - 1;\n        const prev26 = ema26[prevIdx];\n        const prev200 = ema200[prevIdx];\n        const last26 = ema26[lastIdx];\n        const last200 = ema200[lastIdx];\n        let matched = false;\n        if (typeof prev26 === 'number' && typeof prev200 === 'number' && typeof last26 === 'number' && typeof last200 === 'number') {\n          if (type === 'golden') {\n            if (prev26 <= prev200 && last26 > last200) matched = true;\n          } else if (type === 'dead') {\n            if (prev26 >= prev200 && last26 < last200) matched = true;\n          }\n        }\n        if (matched) {\n          const ev = {\n            symbol: sym,\n            last26,\n            last200,\n            time: new Date().toLocaleString()\n          };\n          results.unshift(ev);\n          notify();\n        }\n      } catch (e) {\n        // ignore\n      }\n      progress.done += 1;\n      notify();\n      await sleep(1000);\n    }\n    running = false;\n    currentSymbol = null;\n    cancel = false;\n    notify();\n  }\n  function stop() {\n    cancel = true;\n    running = false;\n    currentSymbol = null;\n    notify();\n  }\n  function getState() {\n    return {\n      running,\n      currentSymbol,\n      progress: {\n        ...progress\n      },\n      results: results.slice()\n    };\n  }\n  return {\n    onUpdate,\n    setGetSymbols,\n    start,\n    stop,\n    getState\n  };\n})();\nexport default scannerManager;","map":{"version":3,"names":["scannerManager","running","currentSymbol","progress","done","total","results","cancel","listeners","Set","getSymbolsFn","notify","state","slice","cb","e","onUpdate","add","delete","setGetSymbols","fn","sleep","ms","Promise","r","setTimeout","calculateEma","values","period","Array","isArray","length","k","out","ema","i","v","Number","isNaN","push","map","s","reduce","a","b","start","type","Error","list","resolve","filtered","filter","test","endpointBase","sym","url","encodeURIComponent","fetch","ok","status","data","json","closes","d","parseFloat","ema26","ema200","lastIdx","prevIdx","prev26","prev200","last26","last200","matched","ev","symbol","time","Date","toLocaleString","unshift","stop","getState"],"sources":["C:/Users/e1it3/Desktop/program/binance_alert/src/lib/scannerManager.js"],"sourcesContent":["// Simple singleton scanner manager to run scans independent of React component lifecycle.\r\nconst scannerManager = (() => {\r\n  let running = false;\r\n  let currentSymbol = null;\r\n  let progress = { done: 0, total: 0 };\r\n  let results = [];\r\n  let cancel = false;\r\n  let listeners = new Set();\r\n  let getSymbolsFn = null;\r\n\r\n  function notify() {\r\n    const state = { running, currentSymbol, progress: { ...progress }, results: results.slice() };\r\n    for (const cb of listeners) {\r\n      try { cb(state); } catch (e) {}\r\n    }\r\n  }\r\n\r\n  function onUpdate(cb) { listeners.add(cb); return () => listeners.delete(cb); }\r\n\r\n  function setGetSymbols(fn) { getSymbolsFn = fn; }\r\n\r\n  function sleep(ms) { return new Promise((r) => setTimeout(r, ms)); }\r\n\r\n  // same EMA helper as used in ScannerPage\r\n  function calculateEma(values, period) {\r\n    if (!Array.isArray(values) || values.length === 0) return [];\r\n    const k = 2 / (period + 1);\r\n    const out = [];\r\n    let ema = null;\r\n    for (let i = 0; i < values.length; i++) {\r\n      const v = Number(values[i]);\r\n      if (isNaN(v)) { out.push(null); continue; }\r\n      if (ema === null) {\r\n        if (i + 1 >= period) {\r\n          const slice = values.slice(i + 1 - period, i + 1).map(Number);\r\n          const s = slice.reduce((a, b) => a + b, 0) / period;\r\n          ema = s;\r\n          out.push(ema);\r\n        } else { out.push(null); }\r\n      } else {\r\n        ema = v * k + ema * (1 - k);\r\n        out.push(ema);\r\n      }\r\n    }\r\n    return out;\r\n  }\r\n\r\n  async function start(type) {\r\n    if (running) return;\r\n    if (typeof getSymbolsFn !== 'function') throw new Error('scannerManager: getSymbolsFn not set');\r\n    running = true; cancel = false; results = []; progress = { done: 0, total: 0 }; currentSymbol = null; notify();\r\n    const list = (await Promise.resolve(getSymbolsFn())) || [];\r\n    const filtered = (Array.isArray(list) ? list.filter(s => typeof s === 'string' && /USDT$/i.test(s)) : []);\r\n    progress.total = filtered.length; notify();\r\n    const endpointBase = 'https://fapi.binance.com/fapi/v1/klines';\r\n    for (let i = 0; i < filtered.length; i++) {\r\n      if (cancel) break;\r\n      const sym = filtered[i];\r\n      currentSymbol = sym; notify();\r\n      try {\r\n        const url = `${endpointBase}?symbol=${encodeURIComponent(sym)}&interval=5m&limit=500`;\r\n        const r = await fetch(url);\r\n        if (!r.ok) {\r\n          if (r.status === 429) await sleep(2000);\r\n          progress.done += 1; notify(); await sleep(1000); continue;\r\n        }\r\n        const data = await r.json();\r\n        const closes = (Array.isArray(data) ? data.map(d => parseFloat(d[4])) : []);\r\n        if (!Array.isArray(closes) || closes.length < 210) { progress.done += 1; notify(); await sleep(1000); continue; }\r\n        const ema26 = calculateEma(closes, 26);\r\n        const ema200 = calculateEma(closes, 200);\r\n        const lastIdx = closes.length - 1;\r\n        const prevIdx = lastIdx - 1;\r\n        const prev26 = ema26[prevIdx];\r\n        const prev200 = ema200[prevIdx];\r\n        const last26 = ema26[lastIdx];\r\n        const last200 = ema200[lastIdx];\r\n        let matched = false;\r\n        if (typeof prev26 === 'number' && typeof prev200 === 'number' && typeof last26 === 'number' && typeof last200 === 'number') {\r\n          if (type === 'golden') { if (prev26 <= prev200 && last26 > last200) matched = true; }\r\n          else if (type === 'dead') { if (prev26 >= prev200 && last26 < last200) matched = true; }\r\n        }\r\n        if (matched) {\r\n          const ev = { symbol: sym, last26, last200, time: new Date().toLocaleString() };\r\n          results.unshift(ev);\r\n          notify();\r\n        }\r\n      } catch (e) {\r\n        // ignore\r\n      }\r\n      progress.done += 1; notify();\r\n      await sleep(1000);\r\n    }\r\n    running = false; currentSymbol = null; cancel = false; notify();\r\n  }\r\n\r\n  function stop() { cancel = true; running = false; currentSymbol = null; notify(); }\r\n\r\n  function getState() { return { running, currentSymbol, progress: { ...progress }, results: results.slice() }; }\r\n\r\n  return { onUpdate, setGetSymbols, start, stop, getState };\r\n})();\r\n\r\nexport default scannerManager;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
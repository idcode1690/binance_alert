{"ast":null,"code":"import'./App.css';import React,{useEffect,useRef,useState}from'react';import useEmaCross from'./hooks/useEmaCross';import Alerts from'./components/Alerts';import Metrics from'./components/Metrics';import Controls from'./components/Controls';import DebugPanel from'./components/DebugPanel';import Notes from'./components/Notes';import Header from'./components/Header';import TopMenu from'./components/TopMenu';import ScannerPage from'./pages/ScannerPage';// 클라이언트 측 스캐너는 서버(Cloudflare Worker) cron 기반으로 대체되므로 임시 비활성화\n// import scannerManager from './lib/scannerManager';\nimport{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";function beep(){try{const AudioCtx=window.AudioContext||window.webkitAudioContext;const ctx=new AudioCtx();const o=ctx.createOscillator();const g=ctx.createGain();o.type='sine';o.frequency.value=880;o.connect(g);g.connect(ctx.destination);o.start();g.gain.setValueAtTime(0.0001,ctx.currentTime);g.gain.exponentialRampToValueAtTime(0.1,ctx.currentTime+0.01);g.gain.exponentialRampToValueAtTime(0.0001,ctx.currentTime+0.6);setTimeout(()=>{o.stop();try{ctx.close();}catch(e){}},700);}catch(e){// ignore\n}}function App(){const[symbol,setSymbol]=useState(()=>{try{const raw=localStorage.getItem('lastSymbol');if(raw&&typeof raw==='string')return raw.toString().replace(/[^A-Za-z0-9]/g,'').toUpperCase();}catch(e){}return'BTCUSDT';});const[autoStart,setAutoStart]=useState(true);const[symbolValid,setSymbolValid]=useState(null);// null=unknown, true/false\n// symbolValidateTimer moved into Controls component\nconst[availableSymbols,setAvailableSymbols]=useState(null);const[showDebug]=useState(false);const[suggestions,setSuggestions]=useState([]);// monitoring inputs (minutes + EMA short/long)\nconst[monitorMinutes,setMonitorMinutes]=useState(()=>{try{const raw=localStorage.getItem('lastMonitor');if(raw){const parsed=JSON.parse(raw);if(parsed&&typeof parsed.monitorMinutes!=='undefined')return Number(parsed.monitorMinutes)||5;}}catch(e){}return 5;});const[monitorEma1,setMonitorEma1]=useState(()=>{try{const raw=localStorage.getItem('lastMonitor');if(raw){const parsed=JSON.parse(raw);if(parsed&&typeof parsed.monitorEma1!=='undefined')return Number(parsed.monitorEma1)||26;}}catch(e){}return 26;});const[monitorEma2,setMonitorEma2]=useState(()=>{try{const raw=localStorage.getItem('lastMonitor');if(raw){const parsed=JSON.parse(raw);if(parsed&&typeof parsed.monitorEma2!=='undefined')return Number(parsed.monitorEma2)||200;}}catch(e){}return 200;});const[monitorConfirm,setMonitorConfirm]=useState(()=>{try{const raw=localStorage.getItem('lastMonitor');if(raw){const parsed=JSON.parse(raw);if(parsed&&typeof parsed.monitorConfirm!=='undefined')return Number(parsed.monitorConfirm)||1;}}catch(e){}// increase default confirmation to 2 closed candles to reduce false positives\nreturn 2;});const[marketCheckResult,setMarketCheckResult]=useState(null);// helper to fetch exchangeInfo and populate availableSymbols\nasync function fetchExchangeInfo(){try{// default to Binance Futures (USDT-M) exchangeInfo for symbols\nconst res=await fetch('https://fapi.binance.com/fapi/v1/exchangeInfo');if(!res.ok){console.warn('exchangeInfo fetch failed',res.status);setAvailableSymbols([]);return;}const data=await res.json();const syms=(data.symbols||[]).map(s=>s.symbol);setAvailableSymbols(syms);}catch(e){console.warn('exchangeInfo fetch error',e);setAvailableSymbols([]);}}// fetch full symbol list once on mount for reliable validation\n// fetch full symbol list once on mount for reliable validation\n// eslint-disable-next-line react-hooks/exhaustive-deps\nuseEffect(()=>{fetchExchangeInfo();},[]);// helper to validate a symbol (returns true/false)\nasync function validateSymbolOnce(s){const q=(s||'').replace(/[^A-Za-z0-9]/g,'').toUpperCase();if(!q)return false;// If we have a cached symbol list, compare using a normalized form (strip non-alnum, uppercase)\nif(availableSymbols&&availableSymbols.length>0){const normQ=q;for(const sym of availableSymbols){const normSym=(sym||'').replace(/[^A-Za-z0-9]/g,'').toUpperCase();if(normSym===normQ)return true;}return false;}// Fallback to exchangeInfo query for the single symbol\ntry{// fallback to Binance Futures exchangeInfo lookup\nconst res=await fetch(\"https://fapi.binance.com/fapi/v1/exchangeInfo?symbol=\".concat(q));if(!res.ok)return false;const data=await res.json();// if API returned an object with matching symbol(s), accept it\nif(data&&Array.isArray(data.symbols)&&data.symbols.length>0)return true;if(data&&data.symbol)return true;return false;}catch(e){return false;}}// if symbol becomes invalid, disable autoStart and disconnect to avoid wrong subscriptions\n// (moved below after hook initialization because it depends on connected/disconnect)\n// Disable hook autoConnect: App will control connecting so we can update server monitor symbol first\nconst{ema9,ema26,lastPrice,lastTick,lastCandleClosed,cross,confirmedCross,confirmedSource,connected,status,connect,disconnect,activeSymbol}=useEmaCross({symbol,autoConnect:true,debug:showDebug,interval:\"\".concat(monitorMinutes,\"m\"),emaShort:monitorEma1,emaLong:monitorEma2,confirmClosedCandles:monitorConfirm});const[events,setEvents]=useState([]);const[toast,setToast]=useState(null);// Helper: detect duplicate events and add only if not duplicate\n// Dedup logic: consider events duplicate if symbol + type match and their timestamps are within 5s,\n// or if price matches exactly and symbol+type match. This helps avoid server+client duplicate alerts.\nconst isDuplicateEvent=React.useCallback((newEv,existing)=>{try{if(!existing||!newEv)return false;const aSym=(existing.symbol||'').toString().replace(/[^A-Za-z0-9]/g,'').toUpperCase();const bSym=(newEv.symbol||'').toString().replace(/[^A-Za-z0-9]/g,'').toUpperCase();if(!aSym||!bSym||aSym!==bSym)return false;if((existing.type||'')!==(newEv.type||''))return false;// exact price match\nif(typeof existing.price!=='undefined'&&typeof newEv.price!=='undefined'&&String(existing.price)===String(newEv.price))return true;// timestamp proximity (use ts if available, otherwise parse time)\nconst aTs=typeof existing.ts==='number'?existing.ts:Date.parse(existing.time||'')||0;const bTs=typeof newEv.ts==='number'?newEv.ts:Date.parse(newEv.time||'')||0;if(aTs&&bTs&&Math.abs(aTs-bTs)<=5000)return true;}catch(e){}return false;},[]);const addEvent=React.useCallback(ev=>{setEvents(prev=>{try{if(Array.isArray(prev)&&prev.some(p=>isDuplicateEvent(ev,p))){if(showDebug)console.debug('[App] suppressed duplicate event',ev);return prev;}}catch(e){}return[ev,...prev].slice(0,500);});},[isDuplicateEvent,showDebug]);// Inform scannerManager about available symbols.\n// IMPORTANT: do NOT forward raw scanner \"results\" into the global Alerts/events list here.\n// Scanner results are shown on the separate Scanner page and should not be mixed with Alerts.\n// 서버측 Cron 스캐닝 사용: 클라이언트 스캐너 비활성화\n// useEffect(() => {\n//   try {\n//     scannerManager.setGetSymbols(() => availableSymbols || []);\n//   } catch (e) {}\n// }, [availableSymbols]);\nconst showToast=React.useCallback(function(message){let ok=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;try{setToast({message,ok,ts:Date.now()});// auto-dismiss after 5s\nsetTimeout(()=>{try{setToast(null);}catch(e){}},5000);}catch(e){}},[]);const lastNotified=useRef(null);// Removed SSE/server health state in Pages Functions mode\nconst[view,setView]=useState('alerts');// Resolve serverUrl in this priority:\n// 1) localStorage 'serverUrl' (allows runtime override without rebuild)\n// 2) REACT_APP_SERVER_URL (build-time)\n// 3) same-origin (only works when Pages/Worker share origin)\nconst serverUrl=(()=>{try{const ls=typeof window!=='undefined'?localStorage.getItem('serverUrl')||'':'';const lsTrim=(ls||'').trim();if(lsTrim)return lsTrim.replace(/\\/$/,'');}catch(e){}const envVal=process.env.REACT_APP_SERVER_URL&&typeof process.env.REACT_APP_SERVER_URL==='string'?process.env.REACT_APP_SERVER_URL:'';const envTrim=(envVal||'').trim();if(envTrim)return envTrim.replace(/\\/$/,'');try{if(typeof window!=='undefined'&&window.location&&window.location.origin){return window.location.origin.replace(/\\/$/,'');}}catch(e){}return null;})();// quick setter for serverUrl via prompt, stored in localStorage\nconst promptSetServerUrl=React.useCallback(()=>{try{const cur=serverUrl||'';const v=window.prompt('Set Worker URL (e.g. https://<name>.workers.dev)',cur);if(v==null)return;const trimmed=String(v).trim();if(trimmed)localStorage.setItem('serverUrl',trimmed);else localStorage.removeItem('serverUrl');window.location.reload();}catch(e){}},[serverUrl]);// 서버측 스캔 설정을 프론트 변경값과 동기화 (EMA/분) — 프론트에서 한번 설정하면 서버가 값을 유지\nuseEffect(()=>{if(!serverUrl)return;const ctrl=new AbortController();const t=setTimeout(async()=>{try{const payload={interval:monitorMinutes,emaShort:monitorEma1,emaLong:monitorEma2,scanType:'both'};const res=await fetch(\"\".concat(serverUrl,\"/config\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload),signal:ctrl.signal});if(!res.ok){console.warn('[App] /config sync failed',res.status);}}catch(e){/* no-op */}},200);return()=>{try{ctrl.abort();}catch(e){}clearTimeout(t);};},[serverUrl,monitorMinutes,monitorEma1,monitorEma2]);// Debug helper: simulate a confirmed cross from the frontend (calls /send-alert and adds local event)\nconst simulateConfirmedCross=React.useCallback(forceType=>{try{const type=forceType||confirmedCross||'bull';const sym=(activeSymbol||symbol||'').toString().replace(/[^A-Za-z0-9]/g,'').toUpperCase();const price=lastPrice||0;// Use configured EMA labels (monitorEma1/monitorEma2) in the message text\nconst text=\"\".concat(sym,\" \").concat(type==='bull'?\"Bullish EMA\".concat(monitorEma1,\" > EMA\").concat(monitorEma2):\"Bearish EMA\".concat(monitorEma1,\" < EMA\").concat(monitorEma2),\" @ \").concat(price);// add local event\nconst ev={ts:Date.now(),time:new Date().toLocaleString(),type:type==='bull'?'bull':'bear',price,symbol:sym,source:'client-sim'};addEvent(ev);// fire server send\n(async()=>{if(!serverUrl){// no server configured (static mode): inform user that Telegram relay is disabled\ntry{showToast('Telegram disabled: no server configured',false);}catch(e){}if(showDebug)console.debug('[App] simulateConfirmedCross skipped POST /send-alert because serverUrl is not set');return;}try{if(showDebug)console.debug('[App] simulate sending /send-alert',{url:\"\".concat(serverUrl,\"/send-alert\"),payload:{symbol:sym,price,message:text,emaShort:monitorEma1,emaLong:monitorEma2}});const res=await fetch(\"\".concat(serverUrl,\"/send-alert\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({symbol:sym,price,message:text,emaShort:monitorEma1,emaLong:monitorEma2})});let json=null;try{json=await res.json();}catch(e){json=null;}const sendEv={ts:Date.now(),time:new Date().toLocaleString(),type:'telegram_send',symbol:sym,source:'client-send',ok:res.ok,status:res.status,body:json};addEvent(sendEv);// show immediate toast to user\ntry{showToast(res.ok?\"Telegram send OK (\".concat(sym,\")\"):\"Telegram send failed (\".concat(res.status,\")\"),res.ok);}catch(e){}if(showDebug)console.debug('[App] simulate /send-alert response',sendEv);}catch(e){const errEv={ts:Date.now(),time:new Date().toLocaleString(),type:'telegram_send',symbol:sym,source:'client-send',ok:false,error:String(e)};addEvent(errEv);try{showToast(\"Telegram send error: \".concat(String(e)),false);}catch(err){}if(showDebug)console.debug('[App] simulate send-alert failed',e);}})();}catch(e){if(showDebug)console.debug('[App] simulateConfirmedCross error',e);}},[activeSymbol,symbol,lastPrice,addEvent,showDebug,confirmedCross,showToast,serverUrl,monitorEma1,monitorEma2]);// Removed SSE subscription: the app runs fully client-side with Pages Functions for Telegram relay.\n// helper to ask server to monitor a symbol, then connect the client\nconst setServerAndConnect=React.useCallback(async(sym,opts)=>{const q=(sym||'').toString().replace(/[^A-Za-z0-9]/g,'').toUpperCase();let interval=opts&&typeof opts.interval!=='undefined'?opts.interval:monitorMinutes;// normalize interval to a string accepted by Binance (e.g., '5m'). If a plain number is provided, treat as minutes.\nif(typeof interval==='number'||typeof interval==='string'&&/^\\d+$/.test(String(interval))){interval=\"\".concat(interval,\"m\");}const emaShort=opts&&typeof opts.emaShort!=='undefined'?opts.emaShort:monitorEma1;const emaLong=opts&&typeof opts.emaLong!=='undefined'?opts.emaLong:monitorEma2;// confirmCandles retained previously for server sync; now unused after backend removal\nif(!q){try{connect(sym);}catch(e){}return;}try{connect(q);}catch(e){}// persist the last-used monitor inputs so Alerts/Controls can restore them\ntry{const toStore={monitorMinutes:typeof interval==='string'&&interval.endsWith('m')?Number(interval.replace(/m$/,'')):Number(interval),monitorEma1:Number(emaShort),monitorEma2:Number(emaLong),lastSymbol:q};localStorage.setItem('lastMonitor',JSON.stringify(toStore));}catch(e){}},[connect,monitorMinutes,monitorEma1,monitorEma2]);// 자동 연결: symbol이 유효하고 autoStart가 켜져 있으면 Start 버튼을 누르지 않아도 connect 호출\nuseEffect(()=>{try{const q=(symbol||'').replace(/[^A-Za-z0-9]/g,'').toUpperCase();// only attempt auto-start after the hook has initialized its EMA seed\nif(q&&symbolValid===true&&autoStart&&status==='initialized'){if(!activeSymbol||activeSymbol.toString().toUpperCase()!==q){// ensure server monitor symbol is updated before connecting\ntry{setServerAndConnect(q);}catch(e){connect(q);}}}}catch(e){// ignore\n}},[symbol,symbolValid,autoStart,activeSymbol,connect,setServerAndConnect,status]);// Removed server /health polling in simplified Pages-only mode\n// clearAlerts will be handled inline if needed; no export/import UI\n// --- localStorage에 Alerts 저장/복원 헬퍼 ---\nconst ALERTS_LS_KEY='alerts';function saveAlertsToLocalStorage(arr){try{if(!Array.isArray(arr))return;// 저장 크기 제한을 위해 최신 500개(로컬스토리지라 쿠키보다 여유)\nconst toStore=JSON.stringify(arr.slice(0,500));localStorage.setItem(ALERTS_LS_KEY,toStore);}catch(e){// ignore\n}}function loadAlertsFromLocalStorage(){try{const raw=localStorage.getItem(ALERTS_LS_KEY);if(!raw)return null;const parsed=JSON.parse(raw);if(Array.isArray(parsed))return parsed;return null;}catch(e){return null;}}// 복원: 마운트 시 localStorage에서 alerts 복원 (7일 초과 항목은 제거)\nuseEffect(()=>{try{const saved=loadAlertsFromLocalStorage();if(saved&&Array.isArray(saved)&&saved.length>0){const cutoff=Date.now()-1000*60*60*24*7;// 7 days\nconst normTarget=(symbol||'').replace(/[^A-Za-z0-9]/g,'').toUpperCase();const filtered=saved.filter(ev=>{if(!ev)return false;if(typeof ev.ts==='number'&&ev.ts<cutoff)return false;// try parse time string as fallback\nif(typeof ev.ts!=='number'){const parsed=Date.parse(ev.time||'');if(isNaN(parsed)||parsed<cutoff)return false;}// require event symbol to match the current selected symbol to avoid showing other-pair alerts\nconst evSym=(ev.symbol||'').toString().replace(/[^A-Za-z0-9]/g,'').toUpperCase();return evSym===normTarget;});setEvents(filtered);}}catch(e){}},[symbol]);// Persist monitor inputs whenever they change so UI values are remembered\nuseEffect(()=>{try{const toStore={monitorMinutes,monitorEma1,monitorEma2,monitorConfirm,lastSymbol:symbol};localStorage.setItem('lastMonitor',JSON.stringify(toStore));}catch(e){}},[monitorMinutes,monitorEma1,monitorEma2,monitorConfirm,symbol]);// 저장: events가 바뀔 때마다 localStorage에 반영 (저장 전에 7일 초과 항목 제거)\nuseEffect(()=>{try{const cutoff=Date.now()-1000*60*60*24*7;// 7 days\nconst filtered=(events||[]).filter(ev=>{if(!ev)return false;if(typeof ev.ts==='number')return ev.ts>=cutoff;const parsed=Date.parse(ev.time||'');if(!isNaN(parsed))return parsed>=cutoff;return false;});saveAlertsToLocalStorage(filtered);}catch(e){}},[events]);// Alerts 항목 삭제 핸들러 (ts 기반으로 고유 항목 제거)\nfunction removeAlertByTs(ts){try{const next=(events||[]).filter(ev=>ev&&ev.ts!==ts);setEvents(next);}catch(e){}}// if symbol becomes invalid, disable autoStart and disconnect to avoid wrong subscriptions\nuseEffect(()=>{if(symbolValid===false){if(autoStart)setAutoStart(false);// ensure disconnected\nif(connected)disconnect();}// include dependencies to avoid stale closures\n},[symbolValid,autoStart,connected,disconnect]);// Ask for notification permission on first user interaction\nuseEffect(()=>{const handle=()=>{if('Notification'in window&&Notification.permission==='default'){Notification.requestPermission().then(()=>{});}window.removeEventListener('click',handle);};window.addEventListener('click',handle);return()=>window.removeEventListener('click',handle);},[]);// react to confirmed cross changes and notify (skip initial)\nuseEffect(()=>{if(!confirmedCross)return;// If the confirmed signal came from initial seeding, don't notify — treat as seeded state\nif(confirmedSource==='init'){// ensure we don't trigger notification for seed values\nlastNotified.current=confirmedCross;return;}if(lastNotified.current==null){// seed without notifying\nlastNotified.current=confirmedCross;return;}if(lastNotified.current!==confirmedCross){const type=confirmedCross==='bull'?\"Bullish EMA\".concat(monitorEma1,\" > EMA\").concat(monitorEma2):\"Bearish EMA\".concat(monitorEma1,\" < EMA\").concat(monitorEma2);const symToShowRaw=activeSymbol||symbol||'';const symToShow=(symToShowRaw||'').toString().replace(/[^A-Za-z0-9]/g,'').toUpperCase();// Determine the authoritative price to show/send. Prefer closed-candle `lastPrice`,\n// but fall back to the most recent live tick (`lastTick`) when a closed price\n// isn't yet available. Still skip only when this is the initial seeded value.\nconst priceToUse=typeof lastPrice!=='undefined'&&lastPrice!==null?lastPrice:typeof lastTick!=='undefined'&&lastTick!==null?lastTick:null;if(confirmedSource==='init'){// do not notify for seed values\nlastNotified.current=confirmedCross;return;}if(priceToUse==null){// If we truly have no price at all, skip but log in debug so user can inspect\nif(showDebug)console.debug('[App] skipping notification: no price available (lastPrice & lastTick are null)',{confirmedCross,confirmedSource,activeSymbol,symbol});lastNotified.current=confirmedCross;return;}const body=\"\".concat(symToShow,\" \").concat(type,\" @ \").concat(priceToUse);// Also request the server to send a Telegram message for this confirmed cross.\n// In static/client-only mode (no serverUrl) skip server relay and show a toast.\n(async()=>{if(!serverUrl){try{showToast('Telegram disabled: no server configured',false);}catch(e){}if(showDebug)console.debug('[App] confirmedCross skipped POST /send-alert because serverUrl is not set');return;}// preflight debug\ntry{if(showDebug)console.debug('[App] confirmedCross preparing /send-alert',{serverUrl,payloadPreview:{symbol:symToShow,price:priceToUse}});}catch(e){}const payload={symbol:symToShow,price:priceToUse,message:type+' @ '+priceToUse,emaShort:monitorEma1,emaLong:monitorEma2};// debug: log state used for send-alert so we can trace mismatched alerts\ntry{console.log('[App] sending /send-alert',{sendSym:symToShow,selectedSymbol:symbol,activeSymbol,confirmedCross,confirmedSource,ema9,ema26,lastPrice,lastTick});}catch(e){}// also show a brief UI toast with the same debug info so it's visible without DevTools\ntry{const dbg=\"\".concat(symToShow,\" \").concat(confirmedCross,\" | active:\").concat(activeSymbol||'—',\" | ema:\").concat(typeof ema9==='number'?ema9.toFixed(4):'—',\"/\").concat(typeof ema26==='number'?ema26.toFixed(4):'—',\" | price:\").concat(typeof lastPrice!=='undefined'&&lastPrice!==null?lastPrice:'—');try{showToast(\"[DEBUG] \".concat(dbg),true);}catch(e){console.log('[App] showToast debug failed',e);}}catch(e){}const maxAttempts=3;let attempt=0;let lastError=null;while(attempt<maxAttempts){attempt+=1;try{if(showDebug)console.debug('[App] confirmedCross sending /send-alert attempt',attempt,payload);const res=await fetch(\"\".concat(serverUrl,\"/send-alert\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});let json=null;try{json=await res.json();}catch(e){json=null;}const sendEv={ts:Date.now(),time:new Date().toLocaleString(),type:'telegram_send',symbol:symToShow,source:'client-confirmed',ok:res.ok,status:res.status,body:json,attempt};try{addEvent(sendEv);}catch(e){setEvents(prev=>[sendEv,...prev].slice(0,500));}try{showToast(res.ok?\"Telegram send OK (\".concat(symToShow,\")\"):\"Telegram send failed (\".concat(res.status,\")\"),res.ok);}catch(e){}if(res.ok)break;// success\nlastError=new Error(\"HTTP \".concat(res.status));}catch(e){lastError=e;if(showDebug)console.debug('[App] confirmedCross send attempt failed',attempt,e);}// exponential backoff before retrying\nif(attempt<maxAttempts){const delay=500*Math.pow(2,attempt-1);// 500ms, 1000ms\nawait new Promise(r=>setTimeout(r,delay));}}if(lastError&&showDebug)console.debug('[App] confirmedCross final send error',lastError);})();// browser notification\nif('Notification'in window&&Notification.permission==='granted'){new Notification(type,{body});}// Add a lightweight console trace of the cross event for operational debugging\ntry{console.log('[App] confirmedCross event',{symbol:symToShow,direction:confirmedCross,price:priceToUse,serverUrl,confirmClosedCandles:monitorConfirm});}catch(e){}// beep and log\nbeep();const evObj={ts:Date.now(),time:new Date().toLocaleString(),type:confirmedCross,price:lastPrice,symbol:symToShow,source:confirmedSource||'unknown'};if(showDebug)console.debug('[App] created confirmedCross event',evObj);setEvents(s=>[evObj,...s].slice(0,500));lastNotified.current=confirmedCross;}},[confirmedCross,lastPrice,lastTick,symbol,activeSymbol,confirmedSource,showDebug,addEvent,showToast,ema9,ema26,serverUrl,monitorEma1,monitorEma2,monitorConfirm]);// 심볼이 바뀔 때 이전 심볼의 알림 상태가 남아 있어 잘못된 알림이 뜨는 문제 방지\n// 심볼을 변경하면 lastNotified를 초기화해서 다음 confirmedCross는 초기 시드로 처리되도록 한다.\nuseEffect(()=>{try{lastNotified.current=null;}catch(e){}// also clear displayed events when symbol changes to avoid mixing alerts from different symbols\ntry{setEvents([]);}catch(e){}},[symbol]);// persist last selected symbol so the app remembers it between sessions\nuseEffect(()=>{try{if(!symbol)return;const norm=(symbol||'').toString().replace(/[^A-Za-z0-9]/g,'').toUpperCase();localStorage.setItem('lastSymbol',norm);}catch(e){}},[symbol]);// theme (darkMode) persisted in localStorage\nconst[darkMode,setDarkMode]=useState(()=>{try{return localStorage.getItem('darkMode')==='1';}catch(e){return false;}});const toggleDark=React.useCallback(()=>{try{setDarkMode(d=>{const next=!d;try{localStorage.setItem('darkMode',next?'1':'0');}catch(e){};return next;});}catch(e){}},[]);return/*#__PURE__*/_jsxs(\"div\",{className:\"App \".concat(darkMode?'dark':''),children:[/*#__PURE__*/_jsx(TopMenu,{onNavigate:setView,view:view,darkMode:darkMode,toggleDark:toggleDark}),/*#__PURE__*/_jsx(\"div\",{className:\"container\",children:/*#__PURE__*/_jsx(\"div\",{className:\"card \".concat(view==='alerts'?'view-alerts':''),children:view==='scanner'?/*#__PURE__*/_jsx(ScannerPage,{availableSymbols:availableSymbols,fetchExchangeInfo:fetchExchangeInfo,monitorMinutes:monitorMinutes,setMonitorMinutes:setMonitorMinutes,monitorEma1:monitorEma1,setMonitorEma1:setMonitorEma1,monitorEma2:monitorEma2,setMonitorEma2:setMonitorEma2}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Header,{}),toast&&/*#__PURE__*/_jsxs(\"div\",{className:\"toast \".concat(toast.ok?'toast-ok':'toast-err'),role:\"status\",\"aria-live\":\"polite\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"toast-title\",children:toast.ok?'Success':'Error'}),/*#__PURE__*/_jsx(\"div\",{className:\"toast-body\",children:toast.message})]}),/*#__PURE__*/_jsx(Controls,{symbol:symbol,setSymbol:setSymbol,symbolValid:symbolValid,setSymbolValid:setSymbolValid,suggestions:suggestions,setSuggestions:setSuggestions,availableSymbols:availableSymbols,validateSymbolOnce:validateSymbolOnce,connect:setServerAndConnect,disconnect:disconnect,status:status,connected:connected// monitoring inputs\n,monitorMinutes:monitorMinutes,setMonitorMinutes:setMonitorMinutes,monitorEma1:monitorEma1,setMonitorEma1:setMonitorEma1,monitorEma2:monitorEma2,setMonitorEma2:setMonitorEma2,monitorConfirm:monitorConfirm,setMonitorConfirm:setMonitorConfirm}),status==='reloading'&&/*#__PURE__*/_jsx(\"div\",{className:\"loading-text\",children:\"\\uCD08\\uAE30\\uD654 \\uC911... \\uC7A0\\uC2DC\\uB9CC \\uAE30\\uB2E4\\uB824\\uC8FC\\uC138\\uC694\"}),symbolValid===false&&/*#__PURE__*/_jsxs(\"div\",{className:\"invalid-msg\",children:[\"Invalid symbol \\u2014 please check the trading pair (e.g. BTCUSDT)\",suggestions&&suggestions.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"suggestions-wrap\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"suggestions-title\",children:\"Did you mean:\"}),/*#__PURE__*/_jsx(\"div\",{className:\"suggestions-list\",children:suggestions.map(s=>/*#__PURE__*/_jsx(\"button\",{className:\"suggestion-btn\",onClick:()=>{setSymbol(s);setSymbolValid(true);setSuggestions([]);try{if(autoStart)setServerAndConnect(s);}catch(e){}},children:s},s))})]})]}),view==='debug'?/*#__PURE__*/_jsx(DebugPanel,{availableSymbols:availableSymbols,fetchExchangeInfo:fetchExchangeInfo,showDebug:showDebug,setMarketCheckResult:setMarketCheckResult,marketCheckResult:marketCheckResult,symbol:symbol,onSimulateAlert:simulateConfirmedCross}):null,/*#__PURE__*/_jsxs(\"div\",{className:\"status\",children:[\"Status: \",/*#__PURE__*/_jsx(\"strong\",{children:status}),\" \",connected?/*#__PURE__*/_jsx(\"span\",{className:\"status-connected\",children:\"(connected)\"}):/*#__PURE__*/_jsx(\"span\",{className:\"status-disconnected\",children:\"(disconnected)\"})]}),/*#__PURE__*/_jsx(Metrics,{activeSymbol:activeSymbol,symbol:symbol,lastPrice:lastPrice,lastTick:lastTick,lastCandleClosed:lastCandleClosed,cross:cross,confirmedCross:confirmedCross,ema9:ema9,ema26:ema26,monitorEma1:monitorEma1,monitorEma2:monitorEma2}),/*#__PURE__*/_jsx(Alerts,{events:events,removeAlertByTs:removeAlertByTs,symbol:symbol,symbolValid:symbolValid,status:status,connect:setServerAndConnect,disconnect:disconnect,monitorMinutes:monitorMinutes,monitorEma1:monitorEma1,monitorEma2:monitorEma2,monitorConfirm:monitorConfirm}),/*#__PURE__*/_jsx(Notes,{children:\"Notes: This app uses Binance public REST + websocket. Make sure network allows wss access to stream.binance.com.\"})]})})})]});}export default App;","map":{"version":3,"names":["React","useEffect","useRef","useState","useEmaCross","Alerts","Metrics","Controls","DebugPanel","Notes","Header","TopMenu","ScannerPage","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","beep","AudioCtx","window","AudioContext","webkitAudioContext","ctx","o","createOscillator","g","createGain","type","frequency","value","connect","destination","start","gain","setValueAtTime","currentTime","exponentialRampToValueAtTime","setTimeout","stop","close","e","App","symbol","setSymbol","raw","localStorage","getItem","toString","replace","toUpperCase","autoStart","setAutoStart","symbolValid","setSymbolValid","availableSymbols","setAvailableSymbols","showDebug","suggestions","setSuggestions","monitorMinutes","setMonitorMinutes","parsed","JSON","parse","Number","monitorEma1","setMonitorEma1","monitorEma2","setMonitorEma2","monitorConfirm","setMonitorConfirm","marketCheckResult","setMarketCheckResult","fetchExchangeInfo","res","fetch","ok","console","warn","status","data","json","syms","symbols","map","s","validateSymbolOnce","q","length","normQ","sym","normSym","concat","Array","isArray","ema9","ema26","lastPrice","lastTick","lastCandleClosed","cross","confirmedCross","confirmedSource","connected","disconnect","activeSymbol","autoConnect","debug","interval","emaShort","emaLong","confirmClosedCandles","events","setEvents","toast","setToast","isDuplicateEvent","useCallback","newEv","existing","aSym","bSym","price","String","aTs","ts","Date","time","bTs","Math","abs","addEvent","ev","prev","some","p","slice","showToast","message","arguments","undefined","now","lastNotified","view","setView","serverUrl","ls","lsTrim","trim","envVal","process","env","REACT_APP_SERVER_URL","envTrim","location","origin","promptSetServerUrl","cur","v","prompt","trimmed","setItem","removeItem","reload","ctrl","AbortController","t","payload","scanType","method","headers","body","stringify","signal","abort","clearTimeout","simulateConfirmedCross","forceType","text","toLocaleString","source","url","sendEv","errEv","error","err","setServerAndConnect","opts","test","toStore","endsWith","lastSymbol","ALERTS_LS_KEY","saveAlertsToLocalStorage","arr","loadAlertsFromLocalStorage","saved","cutoff","normTarget","filtered","filter","isNaN","evSym","removeAlertByTs","next","handle","Notification","permission","requestPermission","then","removeEventListener","addEventListener","current","symToShowRaw","symToShow","priceToUse","payloadPreview","log","sendSym","selectedSymbol","dbg","toFixed","maxAttempts","attempt","lastError","Error","delay","pow","Promise","r","direction","evObj","norm","darkMode","setDarkMode","toggleDark","d","className","children","onNavigate","role","onClick","onSimulateAlert"],"sources":["C:/Users/e1it3/Desktop/program/binance_alert/src/App.js"],"sourcesContent":["import './App.css';\r\nimport React, { useEffect, useRef, useState } from 'react';\r\nimport useEmaCross from './hooks/useEmaCross';\r\nimport Alerts from './components/Alerts';\r\nimport Metrics from './components/Metrics';\r\nimport Controls from './components/Controls';\r\nimport DebugPanel from './components/DebugPanel';\r\nimport Notes from './components/Notes';\r\nimport Header from './components/Header';\r\nimport TopMenu from './components/TopMenu';\r\nimport ScannerPage from './pages/ScannerPage';\r\n// 클라이언트 측 스캐너는 서버(Cloudflare Worker) cron 기반으로 대체되므로 임시 비활성화\r\n// import scannerManager from './lib/scannerManager';\r\n\r\nfunction beep() {\r\n  try {\r\n    const AudioCtx = window.AudioContext || window.webkitAudioContext;\r\n    const ctx = new AudioCtx();\r\n    const o = ctx.createOscillator();\r\n    const g = ctx.createGain();\r\n    o.type = 'sine';\r\n    o.frequency.value = 880;\r\n    o.connect(g);\r\n    g.connect(ctx.destination);\r\n    o.start();\r\n    g.gain.setValueAtTime(0.0001, ctx.currentTime);\r\n    g.gain.exponentialRampToValueAtTime(0.1, ctx.currentTime + 0.01);\r\n    g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.6);\r\n    setTimeout(() => {\r\n      o.stop();\r\n      try { ctx.close(); } catch (e) {}\r\n    }, 700);\r\n  } catch (e) {\r\n    // ignore\r\n  }\r\n}\r\n\r\nfunction App() {\r\n  const [symbol, setSymbol] = useState(() => {\r\n    try {\r\n      const raw = localStorage.getItem('lastSymbol');\r\n      if (raw && typeof raw === 'string') return raw.toString().replace(/[^A-Za-z0-9]/g, '').toUpperCase();\r\n    } catch (e) {}\r\n    return 'BTCUSDT';\r\n  });\r\n  const [autoStart, setAutoStart] = useState(true);\r\n  const [symbolValid, setSymbolValid] = useState(null); // null=unknown, true/false\r\n  // symbolValidateTimer moved into Controls component\r\n  const [availableSymbols, setAvailableSymbols] = useState(null);\r\n  const [showDebug] = useState(false);\r\n  const [suggestions, setSuggestions] = useState([]);\r\n  // monitoring inputs (minutes + EMA short/long)\r\n  const [monitorMinutes, setMonitorMinutes] = useState(() => {\r\n    try {\r\n      const raw = localStorage.getItem('lastMonitor');\r\n      if (raw) {\r\n        const parsed = JSON.parse(raw);\r\n        if (parsed && typeof parsed.monitorMinutes !== 'undefined') return Number(parsed.monitorMinutes) || 5;\r\n      }\r\n    } catch (e) {}\r\n    return 5;\r\n  });\r\n  const [monitorEma1, setMonitorEma1] = useState(() => {\r\n    try {\r\n      const raw = localStorage.getItem('lastMonitor');\r\n      if (raw) {\r\n        const parsed = JSON.parse(raw);\r\n        if (parsed && typeof parsed.monitorEma1 !== 'undefined') return Number(parsed.monitorEma1) || 26;\r\n      }\r\n    } catch (e) {}\r\n    return 26;\r\n  });\r\n  const [monitorEma2, setMonitorEma2] = useState(() => {\r\n    try {\r\n      const raw = localStorage.getItem('lastMonitor');\r\n      if (raw) {\r\n        const parsed = JSON.parse(raw);\r\n        if (parsed && typeof parsed.monitorEma2 !== 'undefined') return Number(parsed.monitorEma2) || 200;\r\n      }\r\n    } catch (e) {}\r\n    return 200;\r\n  });\r\n  const [monitorConfirm, setMonitorConfirm] = useState(() => {\r\n    try {\r\n      const raw = localStorage.getItem('lastMonitor');\r\n      if (raw) {\r\n        const parsed = JSON.parse(raw);\r\n        if (parsed && typeof parsed.monitorConfirm !== 'undefined') return Number(parsed.monitorConfirm) || 1;\r\n      }\r\n    } catch (e) {}\r\n    // increase default confirmation to 2 closed candles to reduce false positives\r\n    return 2;\r\n  });\r\n  const [marketCheckResult, setMarketCheckResult] = useState(null);\r\n  // helper to fetch exchangeInfo and populate availableSymbols\r\n  async function fetchExchangeInfo() {\r\n    try {\r\n      // default to Binance Futures (USDT-M) exchangeInfo for symbols\r\n      const res = await fetch('https://fapi.binance.com/fapi/v1/exchangeInfo');\r\n      if (!res.ok) {\r\n        console.warn('exchangeInfo fetch failed', res.status);\r\n        setAvailableSymbols([]);\r\n        return;\r\n      }\r\n      const data = await res.json();\r\n      const syms = (data.symbols || []).map(s => s.symbol);\r\n      setAvailableSymbols(syms);\r\n    } catch (e) {\r\n      console.warn('exchangeInfo fetch error', e);\r\n      setAvailableSymbols([]);\r\n    }\r\n  }\r\n\r\n  // fetch full symbol list once on mount for reliable validation\r\n  // fetch full symbol list once on mount for reliable validation\r\n  // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  useEffect(() => {\r\n    fetchExchangeInfo();\r\n  }, []);\r\n\r\n\r\n\r\n  // helper to validate a symbol (returns true/false)\r\n  async function validateSymbolOnce(s) {\r\n    const q = (s || '').replace(/[^A-Za-z0-9]/g, '').toUpperCase();\r\n    if (!q) return false;\r\n    // If we have a cached symbol list, compare using a normalized form (strip non-alnum, uppercase)\r\n    if (availableSymbols && availableSymbols.length > 0) {\r\n      const normQ = q;\r\n      for (const sym of availableSymbols) {\r\n        const normSym = (sym || '').replace(/[^A-Za-z0-9]/g, '').toUpperCase();\r\n        if (normSym === normQ) return true;\r\n      }\r\n      return false;\r\n    }\r\n    // Fallback to exchangeInfo query for the single symbol\r\n    try {\r\n      // fallback to Binance Futures exchangeInfo lookup\r\n      const res = await fetch(`https://fapi.binance.com/fapi/v1/exchangeInfo?symbol=${q}`);\r\n      if (!res.ok) return false;\r\n      const data = await res.json();\r\n      // if API returned an object with matching symbol(s), accept it\r\n      if (data && Array.isArray(data.symbols) && data.symbols.length > 0) return true;\r\n      if (data && data.symbol) return true;\r\n      return false;\r\n    } catch (e) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  // if symbol becomes invalid, disable autoStart and disconnect to avoid wrong subscriptions\r\n  // (moved below after hook initialization because it depends on connected/disconnect)\r\n  // Disable hook autoConnect: App will control connecting so we can update server monitor symbol first\r\n  const { ema9, ema26, lastPrice, lastTick, lastCandleClosed, cross, confirmedCross, confirmedSource, connected, status, connect, disconnect, activeSymbol } = useEmaCross({ symbol, autoConnect: true, debug: showDebug, interval: `${monitorMinutes}m`, emaShort: monitorEma1, emaLong: monitorEma2, confirmClosedCandles: monitorConfirm });\r\n\r\n  \r\n  \r\n  const [events, setEvents] = useState([]);\r\n  const [toast, setToast] = useState(null);\r\n  // Helper: detect duplicate events and add only if not duplicate\r\n  // Dedup logic: consider events duplicate if symbol + type match and their timestamps are within 5s,\r\n  // or if price matches exactly and symbol+type match. This helps avoid server+client duplicate alerts.\r\n  const isDuplicateEvent = React.useCallback((newEv, existing) => {\r\n    try {\r\n      if (!existing || !newEv) return false;\r\n      const aSym = (existing.symbol || '').toString().replace(/[^A-Za-z0-9]/g, '').toUpperCase();\r\n      const bSym = (newEv.symbol || '').toString().replace(/[^A-Za-z0-9]/g, '').toUpperCase();\r\n      if (!aSym || !bSym || aSym !== bSym) return false;\r\n      if ((existing.type || '') !== (newEv.type || '')) return false;\r\n      // exact price match\r\n      if (typeof existing.price !== 'undefined' && typeof newEv.price !== 'undefined' && String(existing.price) === String(newEv.price)) return true;\r\n      // timestamp proximity (use ts if available, otherwise parse time)\r\n      const aTs = typeof existing.ts === 'number' ? existing.ts : (Date.parse(existing.time || '') || 0);\r\n      const bTs = typeof newEv.ts === 'number' ? newEv.ts : (Date.parse(newEv.time || '') || 0);\r\n      if (aTs && bTs && Math.abs(aTs - bTs) <= 5000) return true;\r\n    } catch (e) {}\r\n    return false;\r\n  }, []);\r\n\r\n  const addEvent = React.useCallback((ev) => {\r\n    setEvents((prev) => {\r\n      try {\r\n        if (Array.isArray(prev) && prev.some((p) => isDuplicateEvent(ev, p))) {\r\n          if (showDebug) console.debug('[App] suppressed duplicate event', ev);\r\n          return prev;\r\n        }\r\n      } catch (e) {}\r\n      return [ev, ...prev].slice(0, 500);\r\n    });\r\n  }, [isDuplicateEvent, showDebug]);\r\n  // Inform scannerManager about available symbols.\r\n  // IMPORTANT: do NOT forward raw scanner \"results\" into the global Alerts/events list here.\r\n  // Scanner results are shown on the separate Scanner page and should not be mixed with Alerts.\r\n  // 서버측 Cron 스캐닝 사용: 클라이언트 스캐너 비활성화\r\n  // useEffect(() => {\r\n  //   try {\r\n  //     scannerManager.setGetSymbols(() => availableSymbols || []);\r\n  //   } catch (e) {}\r\n  // }, [availableSymbols]);\r\n  const showToast = React.useCallback((message, ok = true) => {\r\n    try {\r\n      setToast({ message, ok, ts: Date.now() });\r\n      // auto-dismiss after 5s\r\n      setTimeout(() => {\r\n        try { setToast(null); } catch (e) {}\r\n      }, 5000);\r\n    } catch (e) {}\r\n  }, []);\r\n  const lastNotified = useRef(null);\r\n  // Removed SSE/server health state in Pages Functions mode\r\n  const [view, setView] = useState('alerts');\r\n  // Resolve serverUrl in this priority:\r\n  // 1) localStorage 'serverUrl' (allows runtime override without rebuild)\r\n  // 2) REACT_APP_SERVER_URL (build-time)\r\n  // 3) same-origin (only works when Pages/Worker share origin)\r\n  const serverUrl = (() => {\r\n    try {\r\n      const ls = (typeof window !== 'undefined') ? (localStorage.getItem('serverUrl') || '') : '';\r\n      const lsTrim = (ls || '').trim();\r\n      if (lsTrim) return lsTrim.replace(/\\/$/, '');\r\n    } catch (e) {}\r\n    const envVal = (process.env.REACT_APP_SERVER_URL && typeof process.env.REACT_APP_SERVER_URL === 'string') ? process.env.REACT_APP_SERVER_URL : '';\r\n    const envTrim = (envVal || '').trim();\r\n    if (envTrim) return envTrim.replace(/\\/$/, '');\r\n    try {\r\n      if (typeof window !== 'undefined' && window.location && window.location.origin) {\r\n        return window.location.origin.replace(/\\/$/, '');\r\n      }\r\n    } catch (e) {}\r\n    return null;\r\n  })();\r\n\r\n  // quick setter for serverUrl via prompt, stored in localStorage\r\n  const promptSetServerUrl = React.useCallback(() => {\r\n    try {\r\n      const cur = (serverUrl || '');\r\n      const v = window.prompt('Set Worker URL (e.g. https://<name>.workers.dev)', cur);\r\n      if (v == null) return;\r\n      const trimmed = String(v).trim();\r\n      if (trimmed) localStorage.setItem('serverUrl', trimmed);\r\n      else localStorage.removeItem('serverUrl');\r\n      window.location.reload();\r\n    } catch (e) {}\r\n  }, [serverUrl]);\r\n\r\n  // 서버측 스캔 설정을 프론트 변경값과 동기화 (EMA/분) — 프론트에서 한번 설정하면 서버가 값을 유지\r\n  useEffect(() => {\r\n    if (!serverUrl) return;\r\n    const ctrl = new AbortController();\r\n    const t = setTimeout(async () => {\r\n      try {\r\n        const payload = { interval: monitorMinutes, emaShort: monitorEma1, emaLong: monitorEma2, scanType: 'both' };\r\n        const res = await fetch(`${serverUrl}/config`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload), signal: ctrl.signal });\r\n        if (!res.ok) {\r\n          console.warn('[App] /config sync failed', res.status);\r\n        }\r\n      } catch (e) { /* no-op */ }\r\n    }, 200);\r\n    return () => { try { ctrl.abort(); } catch (e) {} clearTimeout(t); };\r\n  }, [serverUrl, monitorMinutes, monitorEma1, monitorEma2]);\r\n\r\n  // Debug helper: simulate a confirmed cross from the frontend (calls /send-alert and adds local event)\r\n  const simulateConfirmedCross = React.useCallback((forceType) => {\r\n    try {\r\n      const type = forceType || (confirmedCross || 'bull');\r\n      const sym = (activeSymbol || symbol || '').toString().replace(/[^A-Za-z0-9]/g, '').toUpperCase();\r\n      const price = lastPrice || 0;\r\n  // Use configured EMA labels (monitorEma1/monitorEma2) in the message text\r\n  const text = `${sym} ${type === 'bull' ? `Bullish EMA${monitorEma1} > EMA${monitorEma2}` : `Bearish EMA${monitorEma1} < EMA${monitorEma2}`} @ ${price}`;\r\n      // add local event\r\n      const ev = { ts: Date.now(), time: new Date().toLocaleString(), type: type === 'bull' ? 'bull' : 'bear', price, symbol: sym, source: 'client-sim' };\r\n      addEvent(ev);\r\n      // fire server send\r\n      (async () => {\r\n        if (!serverUrl) {\r\n          // no server configured (static mode): inform user that Telegram relay is disabled\r\n          try { showToast('Telegram disabled: no server configured', false); } catch (e) {}\r\n          if (showDebug) console.debug('[App] simulateConfirmedCross skipped POST /send-alert because serverUrl is not set');\r\n          return;\r\n        }\r\n        try {\r\n          if (showDebug) console.debug('[App] simulate sending /send-alert', { url: `${serverUrl}/send-alert`, payload: { symbol: sym, price, message: text, emaShort: monitorEma1, emaLong: monitorEma2 } });\r\n          const res = await fetch(`${serverUrl}/send-alert`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ symbol: sym, price, message: text, emaShort: monitorEma1, emaLong: monitorEma2 }) });\r\n          let json = null;\r\n          try { json = await res.json(); } catch (e) { json = null; }\r\n          const sendEv = { ts: Date.now(), time: new Date().toLocaleString(), type: 'telegram_send', symbol: sym, source: 'client-send', ok: res.ok, status: res.status, body: json };\r\n          addEvent(sendEv);\r\n          // show immediate toast to user\r\n          try { showToast(res.ok ? `Telegram send OK (${sym})` : `Telegram send failed (${res.status})`, res.ok); } catch (e) {}\r\n          if (showDebug) console.debug('[App] simulate /send-alert response', sendEv);\r\n        } catch (e) {\r\n          const errEv = { ts: Date.now(), time: new Date().toLocaleString(), type: 'telegram_send', symbol: sym, source: 'client-send', ok: false, error: String(e) };\r\n          addEvent(errEv);\r\n          try { showToast(`Telegram send error: ${String(e)}`, false); } catch (err) {}\r\n          if (showDebug) console.debug('[App] simulate send-alert failed', e);\r\n        }\r\n      })();\r\n    } catch (e) { if (showDebug) console.debug('[App] simulateConfirmedCross error', e); }\r\n  }, [activeSymbol, symbol, lastPrice, addEvent, showDebug, confirmedCross, showToast, serverUrl, monitorEma1, monitorEma2]);\r\n\r\n \r\n\r\n  // Removed SSE subscription: the app runs fully client-side with Pages Functions for Telegram relay.\r\n\r\n  // helper to ask server to monitor a symbol, then connect the client\r\n  const setServerAndConnect = React.useCallback(async (sym, opts) => {\r\n    const q = (sym || '').toString().replace(/[^A-Za-z0-9]/g, '').toUpperCase();\r\n  let interval = (opts && typeof opts.interval !== 'undefined') ? opts.interval : monitorMinutes;\r\n    // normalize interval to a string accepted by Binance (e.g., '5m'). If a plain number is provided, treat as minutes.\r\n    if (typeof interval === 'number' || (typeof interval === 'string' && /^\\d+$/.test(String(interval)))) {\r\n      interval = `${interval}m`;\r\n    }\r\n  const emaShort = (opts && typeof opts.emaShort !== 'undefined') ? opts.emaShort : monitorEma1;\r\n  const emaLong = (opts && typeof opts.emaLong !== 'undefined') ? opts.emaLong : monitorEma2;\r\n  // confirmCandles retained previously for server sync; now unused after backend removal\r\n    if (!q) {\r\n      try { connect(sym); } catch (e) {}\r\n      return;\r\n    }\r\n    try { connect(q); } catch (e) {}\r\n    // persist the last-used monitor inputs so Alerts/Controls can restore them\r\n    try {\r\n      const toStore = { monitorMinutes: (typeof interval === 'string' && interval.endsWith('m')) ? Number(interval.replace(/m$/, '')) : Number(interval), monitorEma1: Number(emaShort), monitorEma2: Number(emaLong), lastSymbol: q };\r\n      localStorage.setItem('lastMonitor', JSON.stringify(toStore));\r\n    } catch (e) {}\r\n  }, [connect, monitorMinutes, monitorEma1, monitorEma2]);\r\n\r\n  \r\n\r\n  // 자동 연결: symbol이 유효하고 autoStart가 켜져 있으면 Start 버튼을 누르지 않아도 connect 호출\r\n  useEffect(() => {\r\n    try {\r\n      const q = (symbol || '').replace(/[^A-Za-z0-9]/g, '').toUpperCase();\r\n      // only attempt auto-start after the hook has initialized its EMA seed\r\n      if (q && symbolValid === true && autoStart && status === 'initialized') {\r\n        if (!activeSymbol || activeSymbol.toString().toUpperCase() !== q) {\r\n          // ensure server monitor symbol is updated before connecting\r\n          try { setServerAndConnect(q); } catch (e) { connect(q); }\r\n        }\r\n      }\r\n    } catch (e) {\r\n      // ignore\r\n    }\r\n  }, [symbol, symbolValid, autoStart, activeSymbol, connect, setServerAndConnect, status]);\r\n\r\n  // Removed server /health polling in simplified Pages-only mode\r\n\r\n  // clearAlerts will be handled inline if needed; no export/import UI\r\n\r\n  // --- localStorage에 Alerts 저장/복원 헬퍼 ---\r\n  const ALERTS_LS_KEY = 'alerts';\r\n  function saveAlertsToLocalStorage(arr) {\r\n    try {\r\n      if (!Array.isArray(arr)) return;\r\n      // 저장 크기 제한을 위해 최신 500개(로컬스토리지라 쿠키보다 여유)\r\n      const toStore = JSON.stringify(arr.slice(0, 500));\r\n      localStorage.setItem(ALERTS_LS_KEY, toStore);\r\n    } catch (e) {\r\n      // ignore\r\n    }\r\n  }\r\n\r\n  function loadAlertsFromLocalStorage() {\r\n    try {\r\n      const raw = localStorage.getItem(ALERTS_LS_KEY);\r\n      if (!raw) return null;\r\n      const parsed = JSON.parse(raw);\r\n      if (Array.isArray(parsed)) return parsed;\r\n      return null;\r\n    } catch (e) {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  // 복원: 마운트 시 localStorage에서 alerts 복원 (7일 초과 항목은 제거)\r\n  useEffect(() => {\r\n    try {\r\n      const saved = loadAlertsFromLocalStorage();\r\n      if (saved && Array.isArray(saved) && saved.length > 0) {\r\n        const cutoff = Date.now() - 1000 * 60 * 60 * 24 * 7; // 7 days\r\n        const normTarget = (symbol || '').replace(/[^A-Za-z0-9]/g, '').toUpperCase();\r\n        const filtered = saved.filter((ev) => {\r\n          if (!ev) return false;\r\n          if (typeof ev.ts === 'number' && ev.ts < cutoff) return false;\r\n          // try parse time string as fallback\r\n          if (typeof ev.ts !== 'number') {\r\n            const parsed = Date.parse(ev.time || '');\r\n            if (isNaN(parsed) || parsed < cutoff) return false;\r\n          }\r\n          // require event symbol to match the current selected symbol to avoid showing other-pair alerts\r\n          const evSym = (ev.symbol || '').toString().replace(/[^A-Za-z0-9]/g, '').toUpperCase();\r\n          return evSym === normTarget;\r\n        });\r\n        setEvents(filtered);\r\n      }\r\n    } catch (e) {}\r\n  }, [symbol]);\r\n\r\n  // Persist monitor inputs whenever they change so UI values are remembered\r\n  useEffect(() => {\r\n    try {\r\n      const toStore = { monitorMinutes, monitorEma1, monitorEma2, monitorConfirm, lastSymbol: symbol };\r\n      localStorage.setItem('lastMonitor', JSON.stringify(toStore));\r\n    } catch (e) {}\r\n  }, [monitorMinutes, monitorEma1, monitorEma2, monitorConfirm, symbol]);\r\n\r\n  // 저장: events가 바뀔 때마다 localStorage에 반영 (저장 전에 7일 초과 항목 제거)\r\n  useEffect(() => {\r\n    try {\r\n      const cutoff = Date.now() - 1000 * 60 * 60 * 24 * 7; // 7 days\r\n      const filtered = (events || []).filter((ev) => {\r\n        if (!ev) return false;\r\n        if (typeof ev.ts === 'number') return ev.ts >= cutoff;\r\n        const parsed = Date.parse(ev.time || '');\r\n        if (!isNaN(parsed)) return parsed >= cutoff;\r\n        return false;\r\n      });\r\n      saveAlertsToLocalStorage(filtered);\r\n    } catch (e) {}\r\n  }, [events]);\r\n\r\n  // Alerts 항목 삭제 핸들러 (ts 기반으로 고유 항목 제거)\r\n  function removeAlertByTs(ts) {\r\n    try {\r\n      const next = (events || []).filter((ev) => ev && ev.ts !== ts);\r\n      setEvents(next);\r\n    } catch (e) {}\r\n  }\r\n  \r\n\r\n  // if symbol becomes invalid, disable autoStart and disconnect to avoid wrong subscriptions\r\n  useEffect(() => {\r\n    if (symbolValid === false) {\r\n      if (autoStart) setAutoStart(false);\r\n      // ensure disconnected\r\n      if (connected) disconnect();\r\n    }\r\n    // include dependencies to avoid stale closures\r\n  }, [symbolValid, autoStart, connected, disconnect]);\r\n\r\n  // Ask for notification permission on first user interaction\r\n  useEffect(() => {\r\n    const handle = () => {\r\n      if ('Notification' in window && Notification.permission === 'default') {\r\n        Notification.requestPermission().then(() => {});\r\n      }\r\n      window.removeEventListener('click', handle);\r\n    };\r\n    window.addEventListener('click', handle);\r\n    return () => window.removeEventListener('click', handle);\r\n  }, []);\r\n\r\n  // react to confirmed cross changes and notify (skip initial)\r\n  useEffect(() => {\r\n  if (!confirmedCross) return;\r\n    // If the confirmed signal came from initial seeding, don't notify — treat as seeded state\r\n    if (confirmedSource === 'init') {\r\n      // ensure we don't trigger notification for seed values\r\n      lastNotified.current = confirmedCross;\r\n      return;\r\n    }\r\n    if (lastNotified.current == null) {\r\n      // seed without notifying\r\n      lastNotified.current = confirmedCross;\r\n      return;\r\n    }\r\n\r\n    if (lastNotified.current !== confirmedCross) {\r\n  const type = confirmedCross === 'bull' ? `Bullish EMA${monitorEma1} > EMA${monitorEma2}` : `Bearish EMA${monitorEma1} < EMA${monitorEma2}`;\r\n      const symToShowRaw = activeSymbol || symbol || '';\r\n      const symToShow = (symToShowRaw || '').toString().replace(/[^A-Za-z0-9]/g, '').toUpperCase();\r\n        // Determine the authoritative price to show/send. Prefer closed-candle `lastPrice`,\r\n        // but fall back to the most recent live tick (`lastTick`) when a closed price\r\n        // isn't yet available. Still skip only when this is the initial seeded value.\r\n        const priceToUse = (typeof lastPrice !== 'undefined' && lastPrice !== null) ? lastPrice : ((typeof lastTick !== 'undefined' && lastTick !== null) ? lastTick : null);\r\n        if (confirmedSource === 'init') {\r\n          // do not notify for seed values\r\n          lastNotified.current = confirmedCross;\r\n          return;\r\n        }\r\n        if (priceToUse == null) {\r\n          // If we truly have no price at all, skip but log in debug so user can inspect\r\n          if (showDebug) console.debug('[App] skipping notification: no price available (lastPrice & lastTick are null)', { confirmedCross, confirmedSource, activeSymbol, symbol });\r\n          lastNotified.current = confirmedCross;\r\n          return;\r\n        }\r\n        const body = `${symToShow} ${type} @ ${priceToUse}`;\r\n\r\n      // Also request the server to send a Telegram message for this confirmed cross.\r\n      // In static/client-only mode (no serverUrl) skip server relay and show a toast.\r\n      (async () => {\r\n        if (!serverUrl) {\r\n          try { showToast('Telegram disabled: no server configured', false); } catch (e) {}\r\n          if (showDebug) console.debug('[App] confirmedCross skipped POST /send-alert because serverUrl is not set');\r\n          return;\r\n        }\r\n        // preflight debug\r\n        try { if (showDebug) console.debug('[App] confirmedCross preparing /send-alert', { serverUrl, payloadPreview: { symbol: symToShow, price: priceToUse } }); } catch (e) {}\r\n  const payload = { symbol: symToShow, price: priceToUse, message: type + ' @ ' + priceToUse, emaShort: monitorEma1, emaLong: monitorEma2 };\r\n        // debug: log state used for send-alert so we can trace mismatched alerts\r\n        try {\r\n          console.log('[App] sending /send-alert', { sendSym: symToShow, selectedSymbol: symbol, activeSymbol, confirmedCross, confirmedSource, ema9, ema26, lastPrice, lastTick });\r\n        } catch (e) {}\r\n        // also show a brief UI toast with the same debug info so it's visible without DevTools\r\n        try {\r\n          const dbg = `${symToShow} ${confirmedCross} | active:${activeSymbol || '—'} | ema:${(typeof ema9==='number'?ema9.toFixed(4):'—')}/${(typeof ema26==='number'?ema26.toFixed(4):'—')} | price:${(typeof lastPrice!=='undefined'&&lastPrice!==null)?lastPrice:'—'}`;\r\n          try { showToast(`[DEBUG] ${dbg}`, true); } catch (e) { console.log('[App] showToast debug failed', e); }\r\n        } catch (e) {}\r\n        const maxAttempts = 3;\r\n        let attempt = 0;\r\n        let lastError = null;\r\n        while (attempt < maxAttempts) {\r\n          attempt += 1;\r\n          try {\r\n            if (showDebug) console.debug('[App] confirmedCross sending /send-alert attempt', attempt, payload);\r\n            const res = await fetch(`${serverUrl}/send-alert`, {\r\n              method: 'POST',\r\n              headers: { 'Content-Type': 'application/json' },\r\n              body: JSON.stringify(payload),\r\n            });\r\n            let json = null;\r\n            try { json = await res.json(); } catch (e) { json = null; }\r\n            const sendEv = { ts: Date.now(), time: new Date().toLocaleString(), type: 'telegram_send', symbol: symToShow, source: 'client-confirmed', ok: res.ok, status: res.status, body: json, attempt };\r\n            try { addEvent(sendEv); } catch (e) { setEvents((prev) => [sendEv, ...prev].slice(0, 500)); }\r\n            try { showToast(res.ok ? `Telegram send OK (${symToShow})` : `Telegram send failed (${res.status})`, res.ok); } catch (e) {}\r\n            if (res.ok) break; // success\r\n            lastError = new Error(`HTTP ${res.status}`);\r\n          } catch (e) {\r\n            lastError = e;\r\n            if (showDebug) console.debug('[App] confirmedCross send attempt failed', attempt, e);\r\n          }\r\n          // exponential backoff before retrying\r\n          if (attempt < maxAttempts) {\r\n            const delay = 500 * Math.pow(2, attempt - 1); // 500ms, 1000ms\r\n            await new Promise((r) => setTimeout(r, delay));\r\n          }\r\n        }\r\n        if (lastError && showDebug) console.debug('[App] confirmedCross final send error', lastError);\r\n      })();\r\n\r\n      // browser notification\r\n      if ('Notification' in window && Notification.permission === 'granted') {\r\n        new Notification(type, { body });\r\n      }\r\n\r\n      // Add a lightweight console trace of the cross event for operational debugging\r\n  try { console.log('[App] confirmedCross event', { symbol: symToShow, direction: confirmedCross, price: priceToUse, serverUrl, confirmClosedCandles: monitorConfirm }); } catch (e) {}\r\n\r\n      // beep and log\r\n      beep();\r\n      const evObj = { ts: Date.now(), time: new Date().toLocaleString(), type: confirmedCross, price: lastPrice, symbol: symToShow, source: confirmedSource || 'unknown' };\r\n      if (showDebug) console.debug('[App] created confirmedCross event', evObj);\r\n      setEvents((s) => [evObj, ...s].slice(0, 500));\r\n      lastNotified.current = confirmedCross;\r\n    }\r\n  }, [confirmedCross, lastPrice, lastTick, symbol, activeSymbol, confirmedSource, showDebug, addEvent, showToast, ema9, ema26, serverUrl, monitorEma1, monitorEma2, monitorConfirm]);\r\n\r\n  // 심볼이 바뀔 때 이전 심볼의 알림 상태가 남아 있어 잘못된 알림이 뜨는 문제 방지\r\n  // 심볼을 변경하면 lastNotified를 초기화해서 다음 confirmedCross는 초기 시드로 처리되도록 한다.\r\n  useEffect(() => {\r\n    try {\r\n      lastNotified.current = null;\r\n    } catch (e) {}\r\n    // also clear displayed events when symbol changes to avoid mixing alerts from different symbols\r\n    try { setEvents([]); } catch (e) {}\r\n  }, [symbol]);\r\n\r\n  // persist last selected symbol so the app remembers it between sessions\r\n  useEffect(() => {\r\n    try {\r\n      if (!symbol) return;\r\n      const norm = (symbol || '').toString().replace(/[^A-Za-z0-9]/g, '').toUpperCase();\r\n      localStorage.setItem('lastSymbol', norm);\r\n    } catch (e) {}\r\n  }, [symbol]);\r\n\r\n  // theme (darkMode) persisted in localStorage\r\n  const [darkMode, setDarkMode] = useState(() => { try { return localStorage.getItem('darkMode') === '1'; } catch (e) { return false; } });\r\n  const toggleDark = React.useCallback(() => {\r\n    try {\r\n      setDarkMode((d) => { const next = !d; try { localStorage.setItem('darkMode', next ? '1' : '0'); } catch (e) {} ; return next; });\r\n    } catch (e) {}\r\n  }, []);\r\n\r\n  return (\r\n    <div className={`App ${darkMode ? 'dark' : ''}`}>\r\n  <TopMenu onNavigate={setView} view={view} darkMode={darkMode} toggleDark={toggleDark} />\r\n      <div className=\"container\">\r\n  <div className={`card ${view === 'alerts' ? 'view-alerts' : ''}`}>\r\n              {view === 'scanner' ? (\r\n            <ScannerPage availableSymbols={availableSymbols} fetchExchangeInfo={fetchExchangeInfo} monitorMinutes={monitorMinutes} setMonitorMinutes={setMonitorMinutes} monitorEma1={monitorEma1} setMonitorEma1={setMonitorEma1} monitorEma2={monitorEma2} setMonitorEma2={setMonitorEma2} />\r\n          ) : (\r\n            <>\r\n              <Header />\r\n              {/* inline toast for quick feedback */}\r\n              {toast && (\r\n                <div className={`toast ${toast.ok ? 'toast-ok' : 'toast-err'}`} role=\"status\" aria-live=\"polite\">\r\n                  <div className=\"toast-title\">{toast.ok ? 'Success' : 'Error'}</div>\r\n                  <div className=\"toast-body\">{toast.message}</div>\r\n                </div>\r\n              )}\r\n\r\n              <Controls\r\n                symbol={symbol}\r\n                setSymbol={setSymbol}\r\n                \r\n                symbolValid={symbolValid}\r\n                setSymbolValid={setSymbolValid}\r\n                suggestions={suggestions}\r\n                setSuggestions={setSuggestions}\r\n                availableSymbols={availableSymbols}\r\n                validateSymbolOnce={validateSymbolOnce}\r\n                connect={setServerAndConnect}\r\n                disconnect={disconnect}\r\n                status={status}\r\n                connected={connected}\r\n                // monitoring inputs\r\n                monitorMinutes={monitorMinutes}\r\n                setMonitorMinutes={setMonitorMinutes}\r\n                monitorEma1={monitorEma1}\r\n                setMonitorEma1={setMonitorEma1}\r\n                monitorEma2={monitorEma2}\r\n                setMonitorEma2={setMonitorEma2}\r\n                monitorConfirm={monitorConfirm}\r\n                setMonitorConfirm={setMonitorConfirm}\r\n                \r\n              />\r\n              {/* 간단한 로딩 표시: 심볼 변경으로 상태가 reloading일 때 보임 */}\r\n              {status === 'reloading' && (\r\n                <div className=\"loading-text\">초기화 중... 잠시만 기다려주세요</div>\r\n              )}\r\n              {symbolValid === false && (\r\n                <div className=\"invalid-msg\">\r\n                  Invalid symbol — please check the trading pair (e.g. BTCUSDT)\r\n                  {suggestions && suggestions.length > 0 && (\r\n                    <div className=\"suggestions-wrap\">\r\n                      <div className=\"suggestions-title\">Did you mean:</div>\r\n                      <div className=\"suggestions-list\">\r\n                        {suggestions.map((s) => (\r\n                          <button key={s} className=\"suggestion-btn\" onClick={() => {\r\n                            setSymbol(s);\r\n                            setSymbolValid(true);\r\n                            setSuggestions([]);\r\n                            try { if (autoStart) setServerAndConnect(s); } catch (e) {}\r\n                          }}>{s}</button>\r\n                        ))}\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              )}\r\n\r\n              {view === 'debug' ? (\r\n                <DebugPanel availableSymbols={availableSymbols} fetchExchangeInfo={fetchExchangeInfo} showDebug={showDebug} setMarketCheckResult={setMarketCheckResult} marketCheckResult={marketCheckResult} symbol={symbol} onSimulateAlert={simulateConfirmedCross} />\r\n              ) : null}\r\n\r\n              <div className=\"status\">\r\n                Status: <strong>{status}</strong> {connected ? <span className=\"status-connected\">(connected)</span> : <span className=\"status-disconnected\">(disconnected)</span>}\r\n              </div>\r\n\r\n              <Metrics activeSymbol={activeSymbol} symbol={symbol} lastPrice={lastPrice} lastTick={lastTick} lastCandleClosed={lastCandleClosed} cross={cross} confirmedCross={confirmedCross} ema9={ema9} ema26={ema26} monitorEma1={monitorEma1} monitorEma2={monitorEma2} />\r\n\r\n              <Alerts\r\n                events={events}\r\n                removeAlertByTs={removeAlertByTs}\r\n                symbol={symbol}\r\n                symbolValid={symbolValid}\r\n                status={status}\r\n                connect={setServerAndConnect}\r\n                disconnect={disconnect}\r\n                monitorMinutes={monitorMinutes}\r\n                monitorEma1={monitorEma1}\r\n                monitorEma2={monitorEma2}\r\n                monitorConfirm={monitorConfirm}\r\n              />\r\n\r\n              <Notes>Notes: This app uses Binance public REST + websocket. Make sure network allows wss access to stream.binance.com.</Notes>\r\n            </>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default App;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
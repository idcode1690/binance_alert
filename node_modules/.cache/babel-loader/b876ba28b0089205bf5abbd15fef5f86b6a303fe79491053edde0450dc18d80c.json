{"ast":null,"code":"// Lightweight EMA utilities\n// Provides: sma, calculateInitialEMA, updateEMA, calculateEma (array)\n\nexport function sma(values) {\n  if (!Array.isArray(values) || values.length === 0) return 0;\n  let sum = 0;\n  let count = 0;\n  for (const v of values) {\n    const n = Number(v);\n    if (!Number.isFinite(n)) continue;\n    sum += n;\n    count += 1;\n  }\n  if (count === 0) return 0;\n  return sum / count;\n}\nexport function calculateInitialEMA(values, period) {\n  // calculate the EMA across the provided array and return the last EMA value\n  // Throw if not enough data to seed the EMA\n  if (!Array.isArray(values)) throw new Error('values must be an array');\n  const n = Number(period) || 0;\n  if (!Number.isInteger(n) || n <= 0) throw new Error('period must be a positive integer');\n  if (values.length < n) throw new Error('insufficient data to calculate initial EMA');\n\n  // seed with SMA of the first 'n' values\n  const seedSlice = values.slice(0, n).map(Number);\n  if (seedSlice.some(x => !Number.isFinite(x))) throw new Error('invalid numeric data in values');\n  let ema = seedSlice.reduce((a, b) => a + b, 0) / n;\n  const k = 2 / (n + 1);\n  // iterate remaining values (if any)\n  for (let i = n; i < values.length; i++) {\n    const v = Number(values[i]);\n    if (!Number.isFinite(v)) continue;\n    ema = v * k + ema * (1 - k);\n  }\n  return ema;\n}\nexport function updateEMA(prevEMA, price, period) {\n  const n = Number(period) || 0;\n  if (!Number.isFinite(prevEMA)) throw new Error('prevEMA must be a number');\n  if (!Number.isFinite(Number(price))) throw new Error('price must be a number');\n  if (!Number.isInteger(n) || n <= 0) throw new Error('period must be a positive integer');\n  const k = 2 / (n + 1);\n  return Number(price) * k + prevEMA * (1 - k);\n}\n\n// calculateEma: produce an array of EMA values aligned with input values\n// For indices before enough data exists to seed (period-1), return nulls\nexport function calculateEma(values, period) {\n  if (!Array.isArray(values) || values.length === 0) return [];\n  const n = Number(period) || 0;\n  if (!Number.isInteger(n) || n <= 0) return new Array(values.length).fill(null);\n  const out = new Array(values.length).fill(null);\n  // find first index where we have n values\n  for (let i = 0; i < values.length; i++) {\n    const v = Number(values[i]);\n    if (!Number.isFinite(v)) {\n      out[i] = null;\n      continue;\n    }\n    if (i + 1 < n) {\n      out[i] = null;\n      continue;\n    }\n    if (i + 1 === n) {\n      const slice = values.slice(0, n).map(Number);\n      if (slice.some(x => !Number.isFinite(x))) {\n        out[i] = null;\n        continue;\n      }\n      out[i] = slice.reduce((a, b) => a + b, 0) / n;\n    } else {\n      // ema = v * k + prev * (1-k)\n      const prev = out[i - 1];\n      if (!Number.isFinite(prev)) {\n        out[i] = null;\n        continue;\n      }\n      const k = 2 / (n + 1);\n      out[i] = v * k + prev * (1 - k);\n    }\n  }\n  return out;\n}\nconst ema = {\n  sma,\n  calculateInitialEMA,\n  updateEMA,\n  calculateEma\n};\nexport default ema;","map":{"version":3,"names":["sma","values","Array","isArray","length","sum","count","v","n","Number","isFinite","calculateInitialEMA","period","Error","isInteger","seedSlice","slice","map","some","x","ema","reduce","a","b","k","i","updateEMA","prevEMA","price","calculateEma","fill","out","prev"],"sources":["C:/Users/e1it3/Desktop/program/binance_alert/src/utils/ema.js"],"sourcesContent":["// Lightweight EMA utilities\r\n// Provides: sma, calculateInitialEMA, updateEMA, calculateEma (array)\r\n\r\nexport function sma(values) {\r\n  if (!Array.isArray(values) || values.length === 0) return 0;\r\n  let sum = 0;\r\n  let count = 0;\r\n  for (const v of values) {\r\n    const n = Number(v);\r\n    if (!Number.isFinite(n)) continue;\r\n    sum += n; count += 1;\r\n  }\r\n  if (count === 0) return 0;\r\n  return sum / count;\r\n}\r\n\r\nexport function calculateInitialEMA(values, period) {\r\n  // calculate the EMA across the provided array and return the last EMA value\r\n  // Throw if not enough data to seed the EMA\r\n  if (!Array.isArray(values)) throw new Error('values must be an array');\r\n  const n = Number(period) || 0;\r\n  if (!Number.isInteger(n) || n <= 0) throw new Error('period must be a positive integer');\r\n  if (values.length < n) throw new Error('insufficient data to calculate initial EMA');\r\n\r\n  // seed with SMA of the first 'n' values\r\n  const seedSlice = values.slice(0, n).map(Number);\r\n  if (seedSlice.some((x) => !Number.isFinite(x))) throw new Error('invalid numeric data in values');\r\n  let ema = seedSlice.reduce((a, b) => a + b, 0) / n;\r\n  const k = 2 / (n + 1);\r\n  // iterate remaining values (if any)\r\n  for (let i = n; i < values.length; i++) {\r\n    const v = Number(values[i]);\r\n    if (!Number.isFinite(v)) continue;\r\n    ema = v * k + ema * (1 - k);\r\n  }\r\n  return ema;\r\n}\r\n\r\nexport function updateEMA(prevEMA, price, period) {\r\n  const n = Number(period) || 0;\r\n  if (!Number.isFinite(prevEMA)) throw new Error('prevEMA must be a number');\r\n  if (!Number.isFinite(Number(price))) throw new Error('price must be a number');\r\n  if (!Number.isInteger(n) || n <= 0) throw new Error('period must be a positive integer');\r\n  const k = 2 / (n + 1);\r\n  return Number(price) * k + prevEMA * (1 - k);\r\n}\r\n\r\n// calculateEma: produce an array of EMA values aligned with input values\r\n// For indices before enough data exists to seed (period-1), return nulls\r\nexport function calculateEma(values, period) {\r\n  if (!Array.isArray(values) || values.length === 0) return [];\r\n  const n = Number(period) || 0;\r\n  if (!Number.isInteger(n) || n <= 0) return new Array(values.length).fill(null);\r\n  const out = new Array(values.length).fill(null);\r\n  // find first index where we have n values\r\n  for (let i = 0; i < values.length; i++) {\r\n    const v = Number(values[i]);\r\n    if (!Number.isFinite(v)) { out[i] = null; continue; }\r\n    if (i + 1 < n) { out[i] = null; continue; }\r\n    if (i + 1 === n) {\r\n      const slice = values.slice(0, n).map(Number);\r\n      if (slice.some(x => !Number.isFinite(x))) { out[i] = null; continue; }\r\n      out[i] = slice.reduce((a, b) => a + b, 0) / n;\r\n    } else {\r\n      // ema = v * k + prev * (1-k)\r\n      const prev = out[i - 1];\r\n      if (!Number.isFinite(prev)) { out[i] = null; continue; }\r\n      const k = 2 / (n + 1);\r\n      out[i] = v * k + prev * (1 - k);\r\n    }\r\n  }\r\n  return out;\r\n}\r\n\r\nconst ema = { sma, calculateInitialEMA, updateEMA, calculateEma };\r\nexport default ema;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
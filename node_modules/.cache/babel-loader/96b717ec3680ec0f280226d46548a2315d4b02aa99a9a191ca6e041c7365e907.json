{"ast":null,"code":"import React,{useEffect,useState}from'react';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function formatNumberForDisplay(v){if(typeof v!=='number'||Number.isNaN(v))return'—';// show more precision for small-price assets\nif(Math.abs(v)<1)return v.toFixed(6);if(Math.abs(v)<100)return v.toFixed(4);return v.toFixed(2);}export default function Metrics(_ref){let{activeSymbol,symbol,lastPrice,lastTick,lastCandleClosed,cross,confirmedCross,ema9,ema26,monitorEma1=9,monitorEma2=26}=_ref;const displayPrice=activeSymbol===symbol?typeof lastTick!=='undefined'&&lastTick!==null?formatNumberForDisplay(lastTick):lastPrice!=null?formatNumberForDisplay(lastPrice):'—':'—';// dailyDirection: 'bull' | 'bear' | null\nconst[dailyDirection,setDailyDirection]=useState(null);// Fetch the last 1d candle for the active symbol to determine daily direction\nuseEffect(()=>{let mounted=true;async function fetchDaily(){try{if(!symbol||activeSymbol!==symbol){if(mounted)setDailyDirection(null);return;}const sym=(symbol||'').toString().replace(/[^A-Za-z0-9]/g,'').toUpperCase();if(!sym)return;const url=\"https://fapi.binance.com/fapi/v1/klines?symbol=\".concat(sym,\"&interval=1d&limit=2\");const res=await fetch(url);if(!res.ok)return;const data=await res.json();if(!Array.isArray(data)||data.length===0)return;// Use the last closed daily candle (last element)\nconst last=data[data.length-1];const open=parseFloat(last[1]);const close=parseFloat(last[4]);if(Number.isFinite(open)&&Number.isFinite(close)){if(mounted)setDailyDirection(close>open?'bull':close<open?'bear':'neutral');}}catch(e){// ignore fetch errors\n}}fetchDaily();// refresh daily direction every 5 minutes while the component is mounted\nconst t=setInterval(fetchDaily,5*60*1000);return()=>{mounted=false;clearInterval(t);};},[symbol,activeSymbol]);// sanity-check EMA mapping: ensure provided monitorEma1 < monitorEma2 (short < long)\nuseEffect(()=>{try{if(monitorEma1>=monitorEma2){// eslint-disable-next-line no-console\nconsole.warn('[Metrics] monitorEma1 should be the shorter EMA and monitorEma2 the longer EMA. Current values:',monitorEma1,monitorEma2);}// If the project hardcodes ema9/ema26 but monitorEma props are swapped, warn\nif(monitorEma1===26&&monitorEma2===9){// eslint-disable-next-line no-console\nconsole.warn('[Metrics] Detected monitor EMA props in reverse order (26/9). Ensure EMA1=short and EMA2=long.');}}catch(e){}},[monitorEma1,monitorEma2]);const liveBadgeClass=lastCandleClosed?'badge closed':\"badge open \".concat(dailyDirection==='bull'?'live-bull':dailyDirection==='bear'?'live-bear':'');return/*#__PURE__*/_jsxs(\"div\",{className:\"metrics\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"metric\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"metric-label\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Last price\"}),activeSymbol===symbol?lastCandleClosed?/*#__PURE__*/_jsx(\"span\",{className:\"badge closed\",children:\"CLOSED\"}):/*#__PURE__*/_jsx(\"span\",{className:liveBadgeClass,children:\"LIVE\"}):null]}),/*#__PURE__*/_jsx(\"div\",{children:displayPrice})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"metric\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"metric-label\",children:\"Cross (confirmed)\"}),/*#__PURE__*/_jsx(\"div\",{children:activeSymbol===symbol?confirmedCross!==null&&confirmedCross!==void 0?confirmedCross:'—':'—'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"metric\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"metric-label\",children:\"EMA\".concat(monitorEma1)}),/*#__PURE__*/_jsx(\"div\",{children:activeSymbol===symbol&&ema9?formatNumberForDisplay(ema9):'—'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"metric\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"metric-label\",children:\"EMA\".concat(monitorEma2)}),/*#__PURE__*/_jsx(\"div\",{children:activeSymbol===symbol&&ema26?formatNumberForDisplay(ema26):'—'})]})]});}","map":{"version":3,"names":["React","useEffect","useState","jsx","_jsx","jsxs","_jsxs","formatNumberForDisplay","v","Number","isNaN","Math","abs","toFixed","Metrics","_ref","activeSymbol","symbol","lastPrice","lastTick","lastCandleClosed","cross","confirmedCross","ema9","ema26","monitorEma1","monitorEma2","displayPrice","dailyDirection","setDailyDirection","mounted","fetchDaily","sym","toString","replace","toUpperCase","url","concat","res","fetch","ok","data","json","Array","isArray","length","last","open","parseFloat","close","isFinite","e","t","setInterval","clearInterval","console","warn","liveBadgeClass","className","children"],"sources":["C:/Users/e1it3/Desktop/program/binance_alert/src/components/Metrics.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\n\r\nfunction formatNumberForDisplay(v) {\r\n  if (typeof v !== 'number' || Number.isNaN(v)) return '—';\r\n  // show more precision for small-price assets\r\n  if (Math.abs(v) < 1) return v.toFixed(6);\r\n  if (Math.abs(v) < 100) return v.toFixed(4);\r\n  return v.toFixed(2);\r\n}\r\n\r\nexport default function Metrics({ activeSymbol, symbol, lastPrice, lastTick, lastCandleClosed, cross, confirmedCross, ema9, ema26, monitorEma1 = 9, monitorEma2 = 26 }) {\r\n  const displayPrice = (activeSymbol === symbol)\r\n    ? (typeof lastTick !== 'undefined' && lastTick !== null ? formatNumberForDisplay(lastTick) : (lastPrice != null ? formatNumberForDisplay(lastPrice) : '—'))\r\n    : '—';\r\n\r\n  // dailyDirection: 'bull' | 'bear' | null\r\n  const [dailyDirection, setDailyDirection] = useState(null);\r\n\r\n  // Fetch the last 1d candle for the active symbol to determine daily direction\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    async function fetchDaily() {\r\n      try {\r\n        if (!symbol || activeSymbol !== symbol) {\r\n          if (mounted) setDailyDirection(null);\r\n          return;\r\n        }\r\n        const sym = (symbol || '').toString().replace(/[^A-Za-z0-9]/g, '').toUpperCase();\r\n        if (!sym) return;\r\n        const url = `https://fapi.binance.com/fapi/v1/klines?symbol=${sym}&interval=1d&limit=2`;\r\n        const res = await fetch(url);\r\n        if (!res.ok) return;\r\n        const data = await res.json();\r\n        if (!Array.isArray(data) || data.length === 0) return;\r\n        // Use the last closed daily candle (last element)\r\n        const last = data[data.length - 1];\r\n        const open = parseFloat(last[1]);\r\n        const close = parseFloat(last[4]);\r\n        if (Number.isFinite(open) && Number.isFinite(close)) {\r\n          if (mounted) setDailyDirection(close > open ? 'bull' : (close < open ? 'bear' : 'neutral'));\r\n        }\r\n      } catch (e) {\r\n        // ignore fetch errors\r\n      }\r\n    }\r\n    fetchDaily();\r\n    // refresh daily direction every 5 minutes while the component is mounted\r\n    const t = setInterval(fetchDaily, 5 * 60 * 1000);\r\n    return () => { mounted = false; clearInterval(t); };\r\n  }, [symbol, activeSymbol]);\r\n\r\n  // sanity-check EMA mapping: ensure provided monitorEma1 < monitorEma2 (short < long)\r\n  useEffect(() => {\r\n    try {\r\n      if (monitorEma1 >= monitorEma2) {\r\n        // eslint-disable-next-line no-console\r\n        console.warn('[Metrics] monitorEma1 should be the shorter EMA and monitorEma2 the longer EMA. Current values:', monitorEma1, monitorEma2);\r\n      }\r\n      // If the project hardcodes ema9/ema26 but monitorEma props are swapped, warn\r\n      if ((monitorEma1 === 26 && monitorEma2 === 9)) {\r\n        // eslint-disable-next-line no-console\r\n        console.warn('[Metrics] Detected monitor EMA props in reverse order (26/9). Ensure EMA1=short and EMA2=long.');\r\n      }\r\n    } catch (e) {}\r\n  }, [monitorEma1, monitorEma2]);\r\n\r\n  const liveBadgeClass = lastCandleClosed ? 'badge closed' : `badge open ${dailyDirection === 'bull' ? 'live-bull' : (dailyDirection === 'bear' ? 'live-bear' : '')}`;\r\n\r\n  return (\r\n    <div className=\"metrics\">\r\n      <div className=\"metric\">\r\n        <div className=\"metric-label\">\r\n          <span>Last price</span>\r\n          {activeSymbol === symbol ? (\r\n            lastCandleClosed ? (\r\n              <span className=\"badge closed\">CLOSED</span>\r\n            ) : (\r\n              <span className={liveBadgeClass}>LIVE</span>\r\n            )\r\n          ) : null}\r\n        </div>\r\n        <div>{displayPrice}</div>\r\n      </div>\r\n      <div className=\"metric\"><div className=\"metric-label\">Cross (confirmed)</div><div>{activeSymbol === symbol ? (confirmedCross ?? '—') : '—'}</div></div>\r\n      <div className=\"metric\"><div className=\"metric-label\">{`EMA${monitorEma1}`}</div><div>{activeSymbol === symbol && ema9 ? formatNumberForDisplay(ema9) : '—'}</div></div>\r\n      <div className=\"metric\"><div className=\"metric-label\">{`EMA${monitorEma2}`}</div><div>{activeSymbol === symbol && ema26 ? formatNumberForDisplay(ema26) : '—'}</div></div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
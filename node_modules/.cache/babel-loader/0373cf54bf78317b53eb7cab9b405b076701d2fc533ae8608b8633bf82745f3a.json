{"ast":null,"code":"/* eslint-disable no-unused-vars */import'./App.css';import React,{useEffect,useRef,useState}from'react';import useEmaCross from'./hooks/useEmaCross';import Alerts from'./components/Alerts';import Metrics from'./components/Metrics';import Controls from'./components/Controls';import DebugPanel from'./components/DebugPanel';import Notes from'./components/Notes';import Header from'./components/Header';import TopMenu from'./components/TopMenu';import ScannerPage from'./pages/ScannerPage';// 클라이언트 측 스캐너는 서버(Cloudflare Worker) cron 기반으로 대체되므로 임시 비활성화\n// import scannerManager from './lib/scannerManager';\nimport{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";function beep(){try{const AudioCtx=window.AudioContext||window.webkitAudioContext;const ctx=new AudioCtx();const o=ctx.createOscillator();const g=ctx.createGain();o.type='sine';o.frequency.value=880;o.connect(g);g.connect(ctx.destination);o.start();g.gain.setValueAtTime(0.0001,ctx.currentTime);g.gain.exponentialRampToValueAtTime(0.1,ctx.currentTime+0.01);g.gain.exponentialRampToValueAtTime(0.0001,ctx.currentTime+0.6);setTimeout(()=>{o.stop();try{ctx.close();}catch(e){}},700);}catch(e){// ignore\n}}function App(){const[symbol,setSymbol]=useState(()=>{try{const raw=localStorage.getItem('lastSymbol');if(raw&&typeof raw==='string')return raw.toString().replace(/[^A-Za-z0-9]/g,'').toUpperCase();}catch(e){}return'BTCUSDT';});const[autoStart,setAutoStart]=useState(true);const[symbolValid,setSymbolValid]=useState(null);// null=unknown, true/false\n// symbolValidateTimer moved into Controls component\nconst[availableSymbols,setAvailableSymbols]=useState(null);const[showDebug]=useState(false);const[suggestions,setSuggestions]=useState([]);// monitoring inputs (minutes + EMA short/long)\nconst[monitorMinutes,setMonitorMinutes]=useState(()=>{try{const raw=localStorage.getItem('lastMonitor');if(raw){const parsed=JSON.parse(raw);if(parsed&&typeof parsed.monitorMinutes!=='undefined')return Number(parsed.monitorMinutes)||5;}}catch(e){}return 5;});const[monitorEma1,setMonitorEma1]=useState(()=>{try{const raw=localStorage.getItem('lastMonitor');if(raw){const parsed=JSON.parse(raw);if(parsed&&typeof parsed.monitorEma1!=='undefined')return Number(parsed.monitorEma1)||26;}}catch(e){}return 26;});const[monitorEma2,setMonitorEma2]=useState(()=>{try{const raw=localStorage.getItem('lastMonitor');if(raw){const parsed=JSON.parse(raw);if(parsed&&typeof parsed.monitorEma2!=='undefined')return Number(parsed.monitorEma2)||200;}}catch(e){}return 200;});const[monitorConfirm,setMonitorConfirm]=useState(()=>{try{const raw=localStorage.getItem('lastMonitor');if(raw){const parsed=JSON.parse(raw);if(parsed&&typeof parsed.monitorConfirm!=='undefined')return Number(parsed.monitorConfirm)||1;}}catch(e){}// increase default confirmation to 2 closed candles to reduce false positives\nreturn 2;});const[marketCheckResult,setMarketCheckResult]=useState(null);// helper to fetch exchangeInfo and populate availableSymbols\nasync function fetchExchangeInfo(){try{// default to Binance Futures (USDT-M) exchangeInfo for symbols\nconst res=await fetch('https://fapi.binance.com/fapi/v1/exchangeInfo');if(!res.ok){console.warn('exchangeInfo fetch failed',res.status);setAvailableSymbols([]);return;}const data=await res.json();const syms=(data.symbols||[]).map(s=>s.symbol);setAvailableSymbols(syms);}catch(e){console.warn('exchangeInfo fetch error',e);setAvailableSymbols([]);}}// fetch full symbol list once on mount for reliable validation\n// fetch full symbol list once on mount for reliable validation\n// eslint-disable-next-line react-hooks/exhaustive-deps\nuseEffect(()=>{fetchExchangeInfo();},[]);// helper to validate a symbol (returns true/false)\nasync function validateSymbolOnce(s){const q=(s||'').replace(/[^A-Za-z0-9]/g,'').toUpperCase();if(!q)return false;// If we have a cached symbol list, compare using a normalized form (strip non-alnum, uppercase)\nif(availableSymbols&&availableSymbols.length>0){const normQ=q;for(const sym of availableSymbols){const normSym=(sym||'').replace(/[^A-Za-z0-9]/g,'').toUpperCase();if(normSym===normQ)return true;}return false;}// Fallback to exchangeInfo query for the single symbol\ntry{// fallback to Binance Futures exchangeInfo lookup\nconst res=await fetch(\"https://fapi.binance.com/fapi/v1/exchangeInfo?symbol=\".concat(q));if(!res.ok)return false;const data=await res.json();// if API returned an object with matching symbol(s), accept it\nif(data&&Array.isArray(data.symbols)&&data.symbols.length>0)return true;if(data&&data.symbol)return true;return false;}catch(e){return false;}}// if symbol becomes invalid, disable autoStart and disconnect to avoid wrong subscriptions\n// (moved below after hook initialization because it depends on connected/disconnect)\n// Disable hook autoConnect: App will control connecting so we can update server monitor symbol first\n// Guard against unexpected undefined return (e.g., faulty Jest mock) to keep tests stable.\nconst hookData=useEmaCross({symbol,autoConnect:true,debug:showDebug,interval:\"\".concat(monitorMinutes,\"m\"),emaShort:monitorEma1,emaLong:monitorEma2,confirmClosedCandles:monitorConfirm})||{};const{ema9,ema26,lastPrice,lastTick,lastCandleClosed,cross,confirmedCross,confirmedSource,connected,status,connect,disconnect,activeSymbol}=hookData;const[events,setEvents]=useState([]);const[toast,setToast]=useState(null);// Helper: detect duplicate events and add only if not duplicate\n// Dedup logic: consider events duplicate if symbol + type match and their timestamps are within 5s,\n// or if price matches exactly and symbol+type match. This helps avoid server+client duplicate alerts.\nconst isDuplicateEvent=React.useCallback((newEv,existing)=>{try{if(!existing||!newEv)return false;const aSym=(existing.symbol||'').toString().replace(/[^A-Za-z0-9]/g,'').toUpperCase();const bSym=(newEv.symbol||'').toString().replace(/[^A-Za-z0-9]/g,'').toUpperCase();if(!aSym||!bSym||aSym!==bSym)return false;if((existing.type||'')!==(newEv.type||''))return false;// exact price match\nif(typeof existing.price!=='undefined'&&typeof newEv.price!=='undefined'&&String(existing.price)===String(newEv.price))return true;// timestamp proximity (use ts if available, otherwise parse time)\nconst aTs=typeof existing.ts==='number'?existing.ts:Date.parse(existing.time||'')||0;const bTs=typeof newEv.ts==='number'?newEv.ts:Date.parse(newEv.time||'')||0;if(aTs&&bTs&&Math.abs(aTs-bTs)<=5000)return true;}catch(e){}return false;},[]);const addEvent=React.useCallback(ev=>{setEvents(prev=>{try{if(Array.isArray(prev)&&prev.some(p=>isDuplicateEvent(ev,p))){if(showDebug)console.debug('[App] suppressed duplicate event',ev);return prev;}}catch(e){}return[ev,...prev].slice(0,500);});},[isDuplicateEvent,showDebug]);// Inform scannerManager about available symbols.\n// IMPORTANT: do NOT forward raw scanner \"results\" into the global Alerts/events list here.\n// Scanner results are shown on the separate Scanner page and should not be mixed with Alerts.\n// 서버측 Cron 스캐닝 사용: 클라이언트 스캐너 비활성화\n// useEffect(() => {\n//   try {\n//     scannerManager.setGetSymbols(() => availableSymbols || []);\n//   } catch (e) {}\n// }, [availableSymbols]);\nconst showToast=React.useCallback(function(message){let ok=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;try{setToast({message,ok,ts:Date.now()});// auto-dismiss after 5s\nsetTimeout(()=>{try{setToast(null);}catch(e){}},5000);}catch(e){}},[]);const lastNotified=useRef(null);// Removed SSE/server health state in Pages Functions mode\nconst[view,setView]=useState('alerts');// Resolve serverUrl in this priority:\n// 1) localStorage 'serverUrl' (allows runtime override without rebuild)\n// 2) REACT_APP_SERVER_URL (build-time)\n// 3) same-origin (only works when Pages/Worker share origin)\nconst serverUrl=(()=>{try{const ls=typeof window!=='undefined'?localStorage.getItem('serverUrl')||'':'';const lsTrim=(ls||'').trim();if(lsTrim)return lsTrim.replace(/\\/$/,'');}catch(e){}const envVal=process.env.REACT_APP_SERVER_URL&&typeof process.env.REACT_APP_SERVER_URL==='string'?process.env.REACT_APP_SERVER_URL:'';const envTrim=(envVal||'').trim();if(envTrim)return envTrim.replace(/\\/$/,'');try{if(typeof window!=='undefined'&&window.location&&window.location.origin){return window.location.origin.replace(/\\/$/,'');}}catch(e){}return null;})();// If no runtime server override exists, attempt to auto-set it to the deployed\n// Cloudflare Worker so users who open the app without configuring a server stop\n// hitting stale pages.dev hosts. We do a short health check before persisting.\nuseEffect(()=>{try{const lsVal=typeof window!=='undefined'?localStorage.getItem('serverUrl')||'':'';if(lsVal&&lsVal.trim())return;// already set by user\nconst candidate='https://binance-alert.idcode1690.workers.dev';(async()=>{try{const ctrl=new AbortController();const to=setTimeout(()=>{try{ctrl.abort();}catch(e){}},1500);try{const res=await fetch(\"\".concat(candidate.replace(/\\/$/,''),\"/health\"),{method:'GET',signal:ctrl.signal});if(res&&res.ok){try{localStorage.setItem('serverUrl',candidate);sessionStorage.setItem('serverUrlReachable','1');}catch(e){}try{if(showToast)showToast('Server URL set to worker (auto)',true);}catch(e){}}}catch(e){// health failed -> don't persist anything\n}finally{clearTimeout(to);}}catch(e){}})();}catch(e){}},[showToast]);// quick setter for serverUrl via prompt, stored in localStorage\n// Removed promptSetServerUrl (Controls component provides Set Server URL)\n// 서버측 스캔 설정을 프론트 변경값과 동기화 (EMA/분) — 프론트에서 한번 설정하면 서버가 값을 유지\nuseEffect(()=>{if(!serverUrl)return;// If the runtime serverUrl contains known problematic hostnames (e.g. Pages preview),\n// don't attempt the automatic POST which causes repeated DNS errors in user's console.\ntry{const lower=(serverUrl||'').toLowerCase();if(lower.includes('pages.dev')){try{localStorage.removeItem('serverUrl');}catch(e){}try{showToast('Removed invalid server URL (pages.dev). Please set a valid server URL.',false);}catch(e){}return;}}catch(e){}// Only auto-sync if the server was previously verified reachable in this session,\n// or if the server is same-origin. This avoids blind POST attempts to unreachable hosts.\nconst isSameOrigin=(()=>{try{return typeof window!=='undefined'&&window.location&&window.location.origin&&serverUrl===window.location.origin.replace(/\\/$/,'');}catch(e){return false;}})();const sessionOk=(()=>{try{return sessionStorage.getItem('serverUrlReachable')==='1';}catch(e){return false;}})();const ctrl=new AbortController();const performPost=async()=>{try{const payload={interval:monitorMinutes,emaShort:monitorEma1,emaLong:monitorEma2,scanType:'both'};const res=await fetch(\"\".concat(serverUrl,\"/config\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload),signal:ctrl.signal});if(!res.ok){console.warn('[App] /config sync failed',res.status);}}catch(e){try{console.warn('[App] /config sync error',e);}catch(err){}try{localStorage.removeItem('serverUrl');}catch(err){}try{showToast('Server URL removed due to network error. Please reload the page.',false);}catch(err){}}};const t=setTimeout(async()=>{// If same-origin or we've seen the server reachable in this session, post immediately.\nif(isSameOrigin||sessionOk){await performPost();return;}// Otherwise, do a lightweight health check with short timeout. If it succeeds, mark session ok and post.\nlet healthOk=false;try{const healthCtrl=new AbortController();const healthTimeout=setTimeout(()=>{try{healthCtrl.abort();}catch(e){}},1500);try{const hres=await fetch(\"\".concat(serverUrl.replace(/\\/$/,''),\"/health\"),{method:'GET',signal:healthCtrl.signal});if(hres&&hres.ok){healthOk=true;try{sessionStorage.setItem('serverUrlReachable','1');}catch(e){}}}catch(e){healthOk=false;}finally{clearTimeout(healthTimeout);}}catch(e){healthOk=false;}if(healthOk){await performPost();}else{// Avoid attempting the POST if health check failed — remove runtime override to stop further errors\ntry{localStorage.removeItem('serverUrl');}catch(e){}try{showToast('Server unreachable — cleared configured server URL. Please set a valid server URL.',false);}catch(e){}}},200);return()=>{try{ctrl.abort();}catch(e){}clearTimeout(t);};},[serverUrl,monitorMinutes,monitorEma1,monitorEma2,showToast]);// Debug helper: simulate a confirmed cross from the frontend (calls /send-alert and adds local event)\nconst simulateConfirmedCross=React.useCallback(forceType=>{try{const type=forceType||confirmedCross||'bull';const sym=(activeSymbol||symbol||'').toString().replace(/[^A-Za-z0-9]/g,'').toUpperCase();const price=lastPrice||0;// Use configured EMA labels (monitorEma1/monitorEma2) in the message text\nconst text=\"\".concat(sym,\" \").concat(type==='bull'?\"Bullish EMA\".concat(monitorEma1,\" > EMA\").concat(monitorEma2):\"Bearish EMA\".concat(monitorEma1,\" < EMA\").concat(monitorEma2),\" @ \").concat(price);// add local event\nconst ev={ts:Date.now(),time:new Date().toLocaleString(),type:type==='bull'?'bull':'bear',price,symbol:sym,source:'client-sim'};addEvent(ev);// fire server send\n(async()=>{if(!serverUrl){// no server configured (static mode): inform user that Telegram relay is disabled\ntry{showToast('Telegram disabled: no server configured',false);}catch(e){}if(showDebug)console.debug('[App] simulateConfirmedCross skipped POST /send-alert because serverUrl is not set');return;}try{if(showDebug)console.debug('[App] simulate sending /send-alert',{url:\"\".concat(serverUrl,\"/send-alert\"),payload:{symbol:sym,price,message:text,emaShort:monitorEma1,emaLong:monitorEma2}});const res=await fetch(\"\".concat(serverUrl,\"/send-alert\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({symbol:sym,price,message:text,emaShort:monitorEma1,emaLong:monitorEma2})});let json=null;try{json=await res.json();}catch(e){json=null;}const sendEv={ts:Date.now(),time:new Date().toLocaleString(),type:'telegram_send',symbol:sym,source:'client-send',ok:res.ok,status:res.status,body:json};addEvent(sendEv);// show immediate toast to user\ntry{showToast(res.ok?\"Telegram send OK (\".concat(sym,\")\"):\"Telegram send failed (\".concat(res.status,\")\"),res.ok);}catch(e){}if(showDebug)console.debug('[App] simulate /send-alert response',sendEv);}catch(e){const errEv={ts:Date.now(),time:new Date().toLocaleString(),type:'telegram_send',symbol:sym,source:'client-send',ok:false,error:String(e)};addEvent(errEv);try{showToast(\"Telegram send error: \".concat(String(e)),false);}catch(err){}if(showDebug)console.debug('[App] simulate send-alert failed',e);}})();}catch(e){if(showDebug)console.debug('[App] simulateConfirmedCross error',e);}},[activeSymbol,symbol,lastPrice,addEvent,showDebug,confirmedCross,showToast,serverUrl,monitorEma1,monitorEma2]);// Removed SSE subscription: the app runs fully client-side with Pages Functions for Telegram relay.\n// helper to ask server to monitor a symbol, then connect the client\nconst setServerAndConnect=React.useCallback(async(sym,opts)=>{const q=(sym||'').toString().replace(/[^A-Za-z0-9]/g,'').toUpperCase();let interval=opts&&typeof opts.interval!=='undefined'?opts.interval:monitorMinutes;// normalize interval to a string accepted by Binance (e.g., '5m'). If a plain number is provided, treat as minutes.\nif(typeof interval==='number'||typeof interval==='string'&&/^\\d+$/.test(String(interval))){interval=\"\".concat(interval,\"m\");}const emaShort=opts&&typeof opts.emaShort!=='undefined'?opts.emaShort:monitorEma1;const emaLong=opts&&typeof opts.emaLong!=='undefined'?opts.emaLong:monitorEma2;// confirmCandles retained previously for server sync; now unused after backend removal\nif(!q){try{connect(sym);}catch(e){}return;}// If caller passed monitoring overrides, commit them to parent state so the\n// `useEmaCross` hook receives updated props on next render. We wait a short\n// moment to allow React to flush state before calling `connect` which relies\n// on the hook's `interval`/`emaShort`/`emaLong` values.\ntry{if(opts){try{if(typeof opts.interval!=='undefined'){let v=opts.interval;if(typeof v==='string'&&v.endsWith('m'))v=Number(v.replace(/m$/,''));if(typeof v==='number'&&Number.isFinite(v)&&v>0)setMonitorMinutes(Number(v));}}catch(e){}try{if(typeof opts.emaShort!=='undefined'&&Number.isFinite(Number(opts.emaShort)))setMonitorEma1(Number(opts.emaShort));}catch(e){}try{if(typeof opts.emaLong!=='undefined'&&Number.isFinite(Number(opts.emaLong)))setMonitorEma2(Number(opts.emaLong));}catch(e){}}}catch(e){}// allow React to re-render with new monitor values before connecting\ntry{await new Promise(r=>setTimeout(r,120));}catch(e){}try{connect(q);}catch(e){}// persist the last-used monitor inputs so Alerts/Controls can restore them\ntry{const toStore={monitorMinutes:typeof interval==='string'&&interval.endsWith('m')?Number(interval.replace(/m$/,'')):Number(interval),monitorEma1:Number(emaShort),monitorEma2:Number(emaLong),lastSymbol:q};localStorage.setItem('lastMonitor',JSON.stringify(toStore));}catch(e){}},[connect,monitorMinutes,monitorEma1,monitorEma2]);// 자동 연결: symbol이 유효하고 autoStart가 켜져 있으면 Start 버튼을 누르지 않아도 connect 호출\nuseEffect(()=>{try{const q=(symbol||'').replace(/[^A-Za-z0-9]/g,'').toUpperCase();// only attempt auto-start after the hook has initialized its EMA seed\nif(q&&symbolValid===true&&autoStart&&status==='initialized'){if(!activeSymbol||activeSymbol.toString().toUpperCase()!==q){// ensure server monitor symbol is updated before connecting\ntry{setServerAndConnect(q);}catch(e){connect(q);}}}}catch(e){// ignore\n}},[symbol,symbolValid,autoStart,activeSymbol,connect,setServerAndConnect,status]);// Removed server /health polling in simplified Pages-only mode\n// clearAlerts will be handled inline if needed; no export/import UI\n// --- localStorage에 Alerts 저장/복원 헬퍼 ---\nconst ALERTS_LS_KEY='alerts';function saveAlertsToLocalStorage(arr){try{if(!Array.isArray(arr))return;// 저장 크기 제한을 위해 최신 500개(로컬스토리지라 쿠키보다 여유)\nconst toStore=JSON.stringify(arr.slice(0,500));localStorage.setItem(ALERTS_LS_KEY,toStore);}catch(e){// ignore\n}}function loadAlertsFromLocalStorage(){try{const raw=localStorage.getItem(ALERTS_LS_KEY);if(!raw)return null;const parsed=JSON.parse(raw);if(Array.isArray(parsed))return parsed;return null;}catch(e){return null;}}// 복원: 마운트 시 localStorage에서 alerts 복원 (7일 초과 항목은 제거)\nuseEffect(()=>{try{const saved=loadAlertsFromLocalStorage();if(saved&&Array.isArray(saved)&&saved.length>0){const cutoff=Date.now()-1000*60*60*24*7;// 7 days\nconst normTarget=(symbol||'').replace(/[^A-Za-z0-9]/g,'').toUpperCase();const filtered=saved.filter(ev=>{if(!ev)return false;if(typeof ev.ts==='number'&&ev.ts<cutoff)return false;// try parse time string as fallback\nif(typeof ev.ts!=='number'){const parsed=Date.parse(ev.time||'');if(isNaN(parsed)||parsed<cutoff)return false;}// require event symbol to match the current selected symbol to avoid showing other-pair alerts\nconst evSym=(ev.symbol||'').toString().replace(/[^A-Za-z0-9]/g,'').toUpperCase();return evSym===normTarget;});setEvents(filtered);}}catch(e){}},[symbol]);// Persist monitor inputs whenever they change so UI values are remembered\nuseEffect(()=>{try{const toStore={monitorMinutes,monitorEma1,monitorEma2,monitorConfirm,lastSymbol:symbol};localStorage.setItem('lastMonitor',JSON.stringify(toStore));}catch(e){}},[monitorMinutes,monitorEma1,monitorEma2,monitorConfirm,symbol]);// 저장: events가 바뀔 때마다 localStorage에 반영 (저장 전에 7일 초과 항목 제거)\nuseEffect(()=>{try{const cutoff=Date.now()-1000*60*60*24*7;// 7 days\nconst filtered=(events||[]).filter(ev=>{if(!ev)return false;if(typeof ev.ts==='number')return ev.ts>=cutoff;const parsed=Date.parse(ev.time||'');if(!isNaN(parsed))return parsed>=cutoff;return false;});saveAlertsToLocalStorage(filtered);}catch(e){}},[events]);// Alerts 항목 삭제 핸들러 (ts 기반으로 고유 항목 제거)\nfunction removeAlertByTs(ts){try{const next=(events||[]).filter(ev=>ev&&ev.ts!==ts);setEvents(next);}catch(e){}}// if symbol becomes invalid, disable autoStart and disconnect to avoid wrong subscriptions\nuseEffect(()=>{if(symbolValid===false){if(autoStart)setAutoStart(false);// ensure disconnected\nif(connected)disconnect();}// include dependencies to avoid stale closures\n},[symbolValid,autoStart,connected,disconnect]);// Ask for notification permission on first user interaction\nuseEffect(()=>{const handle=()=>{if('Notification'in window&&Notification.permission==='default'){Notification.requestPermission().then(()=>{});}window.removeEventListener('click',handle);};window.addEventListener('click',handle);return()=>window.removeEventListener('click',handle);},[]);// react to confirmed cross changes and notify (skip initial)\nuseEffect(()=>{if(!confirmedCross)return;// If the confirmed signal came from initial seeding, don't notify — treat as seeded state\nif(confirmedSource==='init'){// ensure we don't trigger notification for seed values\nlastNotified.current=confirmedCross;return;}if(lastNotified.current==null){// First observed cross. If it's from initialization source ('init') skip notify.\n// Otherwise (e.g. mock/live source) allow sending alert immediately.\nif(confirmedSource==='init'){lastNotified.current=confirmedCross;// seed only\nreturn;}// fall through to notify logic below\n}if(lastNotified.current!==confirmedCross){const type=confirmedCross==='bull'?\"Bullish EMA\".concat(monitorEma1,\" > EMA\").concat(monitorEma2):\"Bearish EMA\".concat(monitorEma1,\" < EMA\").concat(monitorEma2);const symToShowRaw=activeSymbol||symbol||'';const symToShow=(symToShowRaw||'').toString().replace(/[^A-Za-z0-9]/g,'').toUpperCase();// Determine the authoritative price to show/send. Prefer closed-candle `lastPrice`,\n// but fall back to the most recent live tick (`lastTick`) when a closed price\n// isn't yet available. Still skip only when this is the initial seeded value.\nconst priceToUse=typeof lastPrice!=='undefined'&&lastPrice!==null?lastPrice:typeof lastTick!=='undefined'&&lastTick!==null?lastTick:null;if(confirmedSource==='init'){// do not notify for seed values\nlastNotified.current=confirmedCross;return;}if(priceToUse==null){// If we truly have no price at all, skip but log in debug so user can inspect\nif(showDebug)console.debug('[App] skipping notification: no price available (lastPrice & lastTick are null)',{confirmedCross,confirmedSource,activeSymbol,symbol});lastNotified.current=confirmedCross;return;}const body=\"\".concat(symToShow,\" \").concat(type,\" @ \").concat(priceToUse);// Also request the server to send a Telegram message for this confirmed cross.\n// In static/client-only mode (no serverUrl) skip server relay and show a toast.\n(async()=>{if(!serverUrl){try{showToast('Telegram disabled: no server configured',false);}catch(e){}if(showDebug)console.debug('[App] confirmedCross skipped POST /send-alert because serverUrl is not set');return;}// preflight debug\ntry{if(showDebug)console.debug('[App] confirmedCross preparing /send-alert',{serverUrl,payloadPreview:{symbol:symToShow,price:priceToUse}});}catch(e){}const payload={symbol:symToShow,price:priceToUse,message:type+' @ '+priceToUse,emaShort:monitorEma1,emaLong:monitorEma2};// debug: log state used for send-alert so we can trace mismatched alerts\ntry{console.log('[App] sending /send-alert',{sendSym:symToShow,selectedSymbol:symbol,activeSymbol,confirmedCross,confirmedSource,ema9,ema26,lastPrice,lastTick});}catch(e){}// also show a brief UI toast with the same debug info so it's visible without DevTools\ntry{const dbg=\"\".concat(symToShow,\" \").concat(confirmedCross,\" | active:\").concat(activeSymbol||'—',\" | ema:\").concat(typeof ema9==='number'?ema9.toFixed(4):'—',\"/\").concat(typeof ema26==='number'?ema26.toFixed(4):'—',\" | price:\").concat(typeof lastPrice!=='undefined'&&lastPrice!==null?lastPrice:'—');try{showToast(\"[DEBUG] \".concat(dbg),true);}catch(e){console.log('[App] showToast debug failed',e);}}catch(e){}const maxAttempts=3;let attempt=0;let lastError=null;while(attempt<maxAttempts){attempt+=1;try{if(showDebug)console.debug('[App] confirmedCross sending /send-alert attempt',attempt,payload);const res=await fetch(\"\".concat(serverUrl,\"/send-alert\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});let json=null;try{json=await res.json();}catch(e){json=null;}const sendEv={ts:Date.now(),time:new Date().toLocaleString(),type:'telegram_send',symbol:symToShow,source:'client-confirmed',ok:res.ok,status:res.status,body:json,attempt};try{addEvent(sendEv);}catch(e){setEvents(prev=>[sendEv,...prev].slice(0,500));}try{showToast(res.ok?\"Telegram send OK (\".concat(symToShow,\")\"):\"Telegram send failed (\".concat(res.status,\")\"),res.ok);}catch(e){}if(res.ok)break;// success\nlastError=new Error(\"HTTP \".concat(res.status));}catch(e){lastError=e;if(showDebug)console.debug('[App] confirmedCross send attempt failed',attempt,e);}// exponential backoff before retrying\nif(attempt<maxAttempts){const delay=500*Math.pow(2,attempt-1);// 500ms, 1000ms\nawait new Promise(r=>setTimeout(r,delay));}}if(lastError&&showDebug)console.debug('[App] confirmedCross final send error',lastError);})();// browser notification\nif('Notification'in window&&Notification.permission==='granted'){new Notification(type,{body});}// Add a lightweight console trace of the cross event for operational debugging\ntry{console.log('[App] confirmedCross event',{symbol:symToShow,direction:confirmedCross,price:priceToUse,serverUrl,confirmClosedCandles:monitorConfirm});}catch(e){}// beep and log\nbeep();const evObj={ts:Date.now(),time:new Date().toLocaleString(),type:confirmedCross,price:lastPrice,symbol:symToShow,source:confirmedSource||'unknown'};if(showDebug)console.debug('[App] created confirmedCross event',evObj);setEvents(s=>[evObj,...s].slice(0,500));lastNotified.current=confirmedCross;}},[confirmedCross,lastPrice,lastTick,symbol,activeSymbol,confirmedSource,showDebug,addEvent,showToast,ema9,ema26,serverUrl,monitorEma1,monitorEma2,monitorConfirm]);// 심볼이 바뀔 때 이전 심볼의 알림 상태가 남아 있어 잘못된 알림이 뜨는 문제 방지\n// 심볼을 변경하면 lastNotified를 초기화해서 다음 confirmedCross는 초기 시드로 처리되도록 한다.\nuseEffect(()=>{try{lastNotified.current=null;}catch(e){}// also clear displayed events when symbol changes to avoid mixing alerts from different symbols\ntry{setEvents([]);}catch(e){}},[symbol]);// persist last selected symbol so the app remembers it between sessions\nuseEffect(()=>{try{if(!symbol)return;const norm=(symbol||'').toString().replace(/[^A-Za-z0-9]/g,'').toUpperCase();localStorage.setItem('lastSymbol',norm);}catch(e){}},[symbol]);// theme (darkMode) persisted in localStorage\nconst[darkMode,setDarkMode]=useState(()=>{try{return localStorage.getItem('darkMode')==='1';}catch(e){return false;}});const toggleDark=React.useCallback(()=>{try{setDarkMode(d=>{const next=!d;try{localStorage.setItem('darkMode',next?'1':'0');}catch(e){};return next;});}catch(e){}},[]);return/*#__PURE__*/_jsxs(\"div\",{className:\"App \".concat(darkMode?'dark':''),children:[/*#__PURE__*/_jsx(TopMenu,{onNavigate:setView,view:view,darkMode:darkMode,toggleDark:toggleDark}),/*#__PURE__*/_jsx(\"div\",{className:\"container\",children:/*#__PURE__*/_jsx(\"div\",{className:\"card \".concat(view==='alerts'?'view-alerts':''),children:view==='scanner'?/*#__PURE__*/_jsx(ScannerPage,{availableSymbols:availableSymbols,fetchExchangeInfo:fetchExchangeInfo,monitorMinutes:monitorMinutes,setMonitorMinutes:setMonitorMinutes,monitorEma1:monitorEma1,setMonitorEma1:setMonitorEma1,monitorEma2:monitorEma2,setMonitorEma2:setMonitorEma2}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Header,{}),toast&&/*#__PURE__*/_jsxs(\"div\",{className:\"toast \".concat(toast.ok?'toast-ok':'toast-err'),role:\"status\",\"aria-live\":\"polite\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"toast-title\",children:toast.ok?'Success':'Error'}),/*#__PURE__*/_jsx(\"div\",{className:\"toast-body\",children:toast.message})]}),/*#__PURE__*/_jsx(Controls,{symbol:symbol,setSymbol:setSymbol,symbolValid:symbolValid,setSymbolValid:setSymbolValid,suggestions:suggestions,setSuggestions:setSuggestions,availableSymbols:availableSymbols,validateSymbolOnce:validateSymbolOnce,connect:setServerAndConnect,disconnect:disconnect,status:status,connected:connected// monitoring inputs\n,monitorMinutes:monitorMinutes,setMonitorMinutes:setMonitorMinutes,monitorEma1:monitorEma1,setMonitorEma1:setMonitorEma1,monitorEma2:monitorEma2,setMonitorEma2:setMonitorEma2,monitorConfirm:monitorConfirm,setMonitorConfirm:setMonitorConfirm// pass serverUrl and toast helper so Controls can manage runtime server setting\n,serverUrl:serverUrl,showToast:showToast}),status==='reloading'&&/*#__PURE__*/_jsx(\"div\",{className:\"loading-text\",children:\"\\uCD08\\uAE30\\uD654 \\uC911... \\uC7A0\\uC2DC\\uB9CC \\uAE30\\uB2E4\\uB824\\uC8FC\\uC138\\uC694\"}),symbolValid===false&&/*#__PURE__*/_jsxs(\"div\",{className:\"invalid-msg\",children:[\"Invalid symbol \\u2014 please check the trading pair (e.g. BTCUSDT)\",suggestions&&suggestions.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"suggestions-wrap\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"suggestions-title\",children:\"Did you mean:\"}),/*#__PURE__*/_jsx(\"div\",{className:\"suggestions-list\",children:suggestions.map(s=>/*#__PURE__*/_jsx(\"button\",{className:\"suggestion-btn\",onClick:()=>{setSymbol(s);setSymbolValid(true);setSuggestions([]);try{if(autoStart)setServerAndConnect(s);}catch(e){}},children:s},s))})]})]}),view==='debug'?/*#__PURE__*/_jsx(DebugPanel,{availableSymbols:availableSymbols,fetchExchangeInfo:fetchExchangeInfo,showDebug:showDebug,setMarketCheckResult:setMarketCheckResult,marketCheckResult:marketCheckResult,symbol:symbol,onSimulateAlert:simulateConfirmedCross}):null,/*#__PURE__*/_jsxs(\"div\",{className:\"status\",children:[\"Status: \",/*#__PURE__*/_jsx(\"strong\",{children:status}),\" \",connected?/*#__PURE__*/_jsx(\"span\",{className:\"status-connected\",children:\"(connected)\"}):/*#__PURE__*/_jsx(\"span\",{className:\"status-disconnected\",children:\"(disconnected)\"})]}),/*#__PURE__*/_jsx(Metrics,{activeSymbol:activeSymbol,symbol:symbol,lastPrice:lastPrice,lastTick:lastTick,lastCandleClosed:lastCandleClosed,cross:cross,confirmedCross:confirmedCross,ema9:ema9,ema26:ema26,monitorEma1:monitorEma1,monitorEma2:monitorEma2}),/*#__PURE__*/_jsx(Alerts,{events:events,removeAlertByTs:removeAlertByTs,symbol:symbol,symbolValid:symbolValid,status:status,connect:setServerAndConnect,disconnect:disconnect,monitorMinutes:monitorMinutes,monitorEma1:monitorEma1,monitorEma2:monitorEma2,monitorConfirm:monitorConfirm}),/*#__PURE__*/_jsx(Notes,{children:\"Notes: This app uses Binance public REST + websocket. Make sure network allows wss access to stream.binance.com.\"})]})})})]});}export default App;","map":{"version":3,"names":["React","useEffect","useRef","useState","useEmaCross","Alerts","Metrics","Controls","DebugPanel","Notes","Header","TopMenu","ScannerPage","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","beep","AudioCtx","window","AudioContext","webkitAudioContext","ctx","o","createOscillator","g","createGain","type","frequency","value","connect","destination","start","gain","setValueAtTime","currentTime","exponentialRampToValueAtTime","setTimeout","stop","close","e","App","symbol","setSymbol","raw","localStorage","getItem","toString","replace","toUpperCase","autoStart","setAutoStart","symbolValid","setSymbolValid","availableSymbols","setAvailableSymbols","showDebug","suggestions","setSuggestions","monitorMinutes","setMonitorMinutes","parsed","JSON","parse","Number","monitorEma1","setMonitorEma1","monitorEma2","setMonitorEma2","monitorConfirm","setMonitorConfirm","marketCheckResult","setMarketCheckResult","fetchExchangeInfo","res","fetch","ok","console","warn","status","data","json","syms","symbols","map","s","validateSymbolOnce","q","length","normQ","sym","normSym","concat","Array","isArray","hookData","autoConnect","debug","interval","emaShort","emaLong","confirmClosedCandles","ema9","ema26","lastPrice","lastTick","lastCandleClosed","cross","confirmedCross","confirmedSource","connected","disconnect","activeSymbol","events","setEvents","toast","setToast","isDuplicateEvent","useCallback","newEv","existing","aSym","bSym","price","String","aTs","ts","Date","time","bTs","Math","abs","addEvent","ev","prev","some","p","slice","showToast","message","arguments","undefined","now","lastNotified","view","setView","serverUrl","ls","lsTrim","trim","envVal","process","env","REACT_APP_SERVER_URL","envTrim","location","origin","lsVal","candidate","ctrl","AbortController","to","abort","method","signal","setItem","sessionStorage","clearTimeout","lower","toLowerCase","includes","removeItem","isSameOrigin","sessionOk","performPost","payload","scanType","headers","body","stringify","err","t","healthOk","healthCtrl","healthTimeout","hres","simulateConfirmedCross","forceType","text","toLocaleString","source","url","sendEv","errEv","error","setServerAndConnect","opts","test","v","endsWith","isFinite","Promise","r","toStore","lastSymbol","ALERTS_LS_KEY","saveAlertsToLocalStorage","arr","loadAlertsFromLocalStorage","saved","cutoff","normTarget","filtered","filter","isNaN","evSym","removeAlertByTs","next","handle","Notification","permission","requestPermission","then","removeEventListener","addEventListener","current","symToShowRaw","symToShow","priceToUse","payloadPreview","log","sendSym","selectedSymbol","dbg","toFixed","maxAttempts","attempt","lastError","Error","delay","pow","direction","evObj","norm","darkMode","setDarkMode","toggleDark","d","className","children","onNavigate","role","onClick","onSimulateAlert"],"sources":["C:/Users/e1it3/Desktop/program/binance_alert/src/App.js"],"sourcesContent":["/* eslint-disable no-unused-vars */\r\nimport './App.css';\r\nimport React, { useEffect, useRef, useState } from 'react';\r\nimport useEmaCross from './hooks/useEmaCross';\r\nimport Alerts from './components/Alerts';\r\nimport Metrics from './components/Metrics';\r\nimport Controls from './components/Controls';\r\nimport DebugPanel from './components/DebugPanel';\r\nimport Notes from './components/Notes';\r\nimport Header from './components/Header';\r\nimport TopMenu from './components/TopMenu';\r\nimport ScannerPage from './pages/ScannerPage';\r\n// 클라이언트 측 스캐너는 서버(Cloudflare Worker) cron 기반으로 대체되므로 임시 비활성화\r\n// import scannerManager from './lib/scannerManager';\r\n\r\nfunction beep() {\r\n  try {\r\n    const AudioCtx = window.AudioContext || window.webkitAudioContext;\r\n    const ctx = new AudioCtx();\r\n    const o = ctx.createOscillator();\r\n    const g = ctx.createGain();\r\n    o.type = 'sine';\r\n    o.frequency.value = 880;\r\n    o.connect(g);\r\n    g.connect(ctx.destination);\r\n    o.start();\r\n    g.gain.setValueAtTime(0.0001, ctx.currentTime);\r\n    g.gain.exponentialRampToValueAtTime(0.1, ctx.currentTime + 0.01);\r\n    g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.6);\r\n    setTimeout(() => {\r\n      o.stop();\r\n      try { ctx.close(); } catch (e) {}\r\n    }, 700);\r\n  } catch (e) {\r\n    // ignore\r\n  }\r\n}\r\n\r\nfunction App() {\r\n  const [symbol, setSymbol] = useState(() => {\r\n    try {\r\n      const raw = localStorage.getItem('lastSymbol');\r\n      if (raw && typeof raw === 'string') return raw.toString().replace(/[^A-Za-z0-9]/g, '').toUpperCase();\r\n    } catch (e) {}\r\n    return 'BTCUSDT';\r\n  });\r\n  const [autoStart, setAutoStart] = useState(true);\r\n  const [symbolValid, setSymbolValid] = useState(null); // null=unknown, true/false\r\n  // symbolValidateTimer moved into Controls component\r\n  const [availableSymbols, setAvailableSymbols] = useState(null);\r\n  const [showDebug] = useState(false);\r\n  const [suggestions, setSuggestions] = useState([]);\r\n  // monitoring inputs (minutes + EMA short/long)\r\n  const [monitorMinutes, setMonitorMinutes] = useState(() => {\r\n    try {\r\n      const raw = localStorage.getItem('lastMonitor');\r\n      if (raw) {\r\n        const parsed = JSON.parse(raw);\r\n        if (parsed && typeof parsed.monitorMinutes !== 'undefined') return Number(parsed.monitorMinutes) || 5;\r\n      }\r\n    } catch (e) {}\r\n    return 5;\r\n  });\r\n  const [monitorEma1, setMonitorEma1] = useState(() => {\r\n    try {\r\n      const raw = localStorage.getItem('lastMonitor');\r\n      if (raw) {\r\n        const parsed = JSON.parse(raw);\r\n        if (parsed && typeof parsed.monitorEma1 !== 'undefined') return Number(parsed.monitorEma1) || 26;\r\n      }\r\n    } catch (e) {}\r\n    return 26;\r\n  });\r\n  const [monitorEma2, setMonitorEma2] = useState(() => {\r\n    try {\r\n      const raw = localStorage.getItem('lastMonitor');\r\n      if (raw) {\r\n        const parsed = JSON.parse(raw);\r\n        if (parsed && typeof parsed.monitorEma2 !== 'undefined') return Number(parsed.monitorEma2) || 200;\r\n      }\r\n    } catch (e) {}\r\n    return 200;\r\n  });\r\n  const [monitorConfirm, setMonitorConfirm] = useState(() => {\r\n    try {\r\n      const raw = localStorage.getItem('lastMonitor');\r\n      if (raw) {\r\n        const parsed = JSON.parse(raw);\r\n        if (parsed && typeof parsed.monitorConfirm !== 'undefined') return Number(parsed.monitorConfirm) || 1;\r\n      }\r\n    } catch (e) {}\r\n    // increase default confirmation to 2 closed candles to reduce false positives\r\n    return 2;\r\n  });\r\n  const [marketCheckResult, setMarketCheckResult] = useState(null);\r\n  // helper to fetch exchangeInfo and populate availableSymbols\r\n  async function fetchExchangeInfo() {\r\n    try {\r\n      // default to Binance Futures (USDT-M) exchangeInfo for symbols\r\n      const res = await fetch('https://fapi.binance.com/fapi/v1/exchangeInfo');\r\n      if (!res.ok) {\r\n        console.warn('exchangeInfo fetch failed', res.status);\r\n        setAvailableSymbols([]);\r\n        return;\r\n      }\r\n      const data = await res.json();\r\n      const syms = (data.symbols || []).map(s => s.symbol);\r\n      setAvailableSymbols(syms);\r\n    } catch (e) {\r\n      console.warn('exchangeInfo fetch error', e);\r\n      setAvailableSymbols([]);\r\n    }\r\n  }\r\n\r\n  // fetch full symbol list once on mount for reliable validation\r\n  // fetch full symbol list once on mount for reliable validation\r\n  // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  useEffect(() => {\r\n    fetchExchangeInfo();\r\n  }, []);\r\n\r\n\r\n\r\n  // helper to validate a symbol (returns true/false)\r\n  async function validateSymbolOnce(s) {\r\n    const q = (s || '').replace(/[^A-Za-z0-9]/g, '').toUpperCase();\r\n    if (!q) return false;\r\n    // If we have a cached symbol list, compare using a normalized form (strip non-alnum, uppercase)\r\n    if (availableSymbols && availableSymbols.length > 0) {\r\n      const normQ = q;\r\n      for (const sym of availableSymbols) {\r\n        const normSym = (sym || '').replace(/[^A-Za-z0-9]/g, '').toUpperCase();\r\n        if (normSym === normQ) return true;\r\n      }\r\n      return false;\r\n    }\r\n    // Fallback to exchangeInfo query for the single symbol\r\n    try {\r\n      // fallback to Binance Futures exchangeInfo lookup\r\n      const res = await fetch(`https://fapi.binance.com/fapi/v1/exchangeInfo?symbol=${q}`);\r\n      if (!res.ok) return false;\r\n      const data = await res.json();\r\n      // if API returned an object with matching symbol(s), accept it\r\n      if (data && Array.isArray(data.symbols) && data.symbols.length > 0) return true;\r\n      if (data && data.symbol) return true;\r\n      return false;\r\n    } catch (e) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  // if symbol becomes invalid, disable autoStart and disconnect to avoid wrong subscriptions\r\n  // (moved below after hook initialization because it depends on connected/disconnect)\r\n  // Disable hook autoConnect: App will control connecting so we can update server monitor symbol first\r\n  // Guard against unexpected undefined return (e.g., faulty Jest mock) to keep tests stable.\r\n  const hookData = useEmaCross({ symbol, autoConnect: true, debug: showDebug, interval: `${monitorMinutes}m`, emaShort: monitorEma1, emaLong: monitorEma2, confirmClosedCandles: monitorConfirm }) || {};\r\n  const { ema9, ema26, lastPrice, lastTick, lastCandleClosed, cross, confirmedCross, confirmedSource, connected, status, connect, disconnect, activeSymbol } = hookData;\r\n\r\n  \r\n  \r\n  const [events, setEvents] = useState([]);\r\n  const [toast, setToast] = useState(null);\r\n  // Helper: detect duplicate events and add only if not duplicate\r\n  // Dedup logic: consider events duplicate if symbol + type match and their timestamps are within 5s,\r\n  // or if price matches exactly and symbol+type match. This helps avoid server+client duplicate alerts.\r\n  const isDuplicateEvent = React.useCallback((newEv, existing) => {\r\n    try {\r\n      if (!existing || !newEv) return false;\r\n      const aSym = (existing.symbol || '').toString().replace(/[^A-Za-z0-9]/g, '').toUpperCase();\r\n      const bSym = (newEv.symbol || '').toString().replace(/[^A-Za-z0-9]/g, '').toUpperCase();\r\n      if (!aSym || !bSym || aSym !== bSym) return false;\r\n      if ((existing.type || '') !== (newEv.type || '')) return false;\r\n      // exact price match\r\n      if (typeof existing.price !== 'undefined' && typeof newEv.price !== 'undefined' && String(existing.price) === String(newEv.price)) return true;\r\n      // timestamp proximity (use ts if available, otherwise parse time)\r\n      const aTs = typeof existing.ts === 'number' ? existing.ts : (Date.parse(existing.time || '') || 0);\r\n      const bTs = typeof newEv.ts === 'number' ? newEv.ts : (Date.parse(newEv.time || '') || 0);\r\n      if (aTs && bTs && Math.abs(aTs - bTs) <= 5000) return true;\r\n    } catch (e) {}\r\n    return false;\r\n  }, []);\r\n\r\n  const addEvent = React.useCallback((ev) => {\r\n    setEvents((prev) => {\r\n      try {\r\n        if (Array.isArray(prev) && prev.some((p) => isDuplicateEvent(ev, p))) {\r\n          if (showDebug) console.debug('[App] suppressed duplicate event', ev);\r\n          return prev;\r\n        }\r\n      } catch (e) {}\r\n      return [ev, ...prev].slice(0, 500);\r\n    });\r\n  }, [isDuplicateEvent, showDebug]);\r\n  // Inform scannerManager about available symbols.\r\n  // IMPORTANT: do NOT forward raw scanner \"results\" into the global Alerts/events list here.\r\n  // Scanner results are shown on the separate Scanner page and should not be mixed with Alerts.\r\n  // 서버측 Cron 스캐닝 사용: 클라이언트 스캐너 비활성화\r\n  // useEffect(() => {\r\n  //   try {\r\n  //     scannerManager.setGetSymbols(() => availableSymbols || []);\r\n  //   } catch (e) {}\r\n  // }, [availableSymbols]);\r\n  const showToast = React.useCallback((message, ok = true) => {\r\n    try {\r\n      setToast({ message, ok, ts: Date.now() });\r\n      // auto-dismiss after 5s\r\n      setTimeout(() => {\r\n        try { setToast(null); } catch (e) {}\r\n      }, 5000);\r\n    } catch (e) {}\r\n  }, []);\r\n  const lastNotified = useRef(null);\r\n  // Removed SSE/server health state in Pages Functions mode\r\n  const [view, setView] = useState('alerts');\r\n  // Resolve serverUrl in this priority:\r\n  // 1) localStorage 'serverUrl' (allows runtime override without rebuild)\r\n  // 2) REACT_APP_SERVER_URL (build-time)\r\n  // 3) same-origin (only works when Pages/Worker share origin)\r\n  const serverUrl = (() => {\r\n    try {\r\n      const ls = (typeof window !== 'undefined') ? (localStorage.getItem('serverUrl') || '') : '';\r\n      const lsTrim = (ls || '').trim();\r\n      if (lsTrim) return lsTrim.replace(/\\/$/, '');\r\n    } catch (e) {}\r\n    const envVal = (process.env.REACT_APP_SERVER_URL && typeof process.env.REACT_APP_SERVER_URL === 'string') ? process.env.REACT_APP_SERVER_URL : '';\r\n    const envTrim = (envVal || '').trim();\r\n    if (envTrim) return envTrim.replace(/\\/$/, '');\r\n    try {\r\n      if (typeof window !== 'undefined' && window.location && window.location.origin) {\r\n        return window.location.origin.replace(/\\/$/, '');\r\n      }\r\n    } catch (e) {}\r\n    return null;\r\n  })();\r\n\r\n  // If no runtime server override exists, attempt to auto-set it to the deployed\r\n  // Cloudflare Worker so users who open the app without configuring a server stop\r\n  // hitting stale pages.dev hosts. We do a short health check before persisting.\r\n  useEffect(() => {\r\n    try {\r\n      const lsVal = (typeof window !== 'undefined') ? (localStorage.getItem('serverUrl') || '') : '';\r\n      if (lsVal && lsVal.trim()) return; // already set by user\r\n      const candidate = 'https://binance-alert.idcode1690.workers.dev';\r\n      (async () => {\r\n        try {\r\n          const ctrl = new AbortController();\r\n          const to = setTimeout(() => { try { ctrl.abort(); } catch (e) {} }, 1500);\r\n          try {\r\n            const res = await fetch(`${candidate.replace(/\\/$/, '')}/health`, { method: 'GET', signal: ctrl.signal });\r\n            if (res && res.ok) {\r\n              try { localStorage.setItem('serverUrl', candidate); sessionStorage.setItem('serverUrlReachable', '1'); } catch (e) {}\r\n              try { if (showToast) showToast('Server URL set to worker (auto)', true); } catch (e) {}\r\n            }\r\n          } catch (e) {\r\n            // health failed -> don't persist anything\r\n          } finally { clearTimeout(to); }\r\n        } catch (e) {}\r\n      })();\r\n    } catch (e) {}\r\n  }, [showToast]);\r\n\r\n  // quick setter for serverUrl via prompt, stored in localStorage\r\n  // Removed promptSetServerUrl (Controls component provides Set Server URL)\r\n\r\n  // 서버측 스캔 설정을 프론트 변경값과 동기화 (EMA/분) — 프론트에서 한번 설정하면 서버가 값을 유지\r\n  useEffect(() => {\r\n    if (!serverUrl) return;\r\n    // If the runtime serverUrl contains known problematic hostnames (e.g. Pages preview),\r\n    // don't attempt the automatic POST which causes repeated DNS errors in user's console.\r\n    try {\r\n      const lower = (serverUrl || '').toLowerCase();\r\n      if (lower.includes('pages.dev')) {\r\n        try { localStorage.removeItem('serverUrl'); } catch (e) {}\r\n        try { showToast('Removed invalid server URL (pages.dev). Please set a valid server URL.', false); } catch (e) {}\r\n        return;\r\n      }\r\n    } catch (e) {}\r\n\r\n    // Only auto-sync if the server was previously verified reachable in this session,\r\n    // or if the server is same-origin. This avoids blind POST attempts to unreachable hosts.\r\n    const isSameOrigin = (() => {\r\n      try { return typeof window !== 'undefined' && window.location && window.location.origin && serverUrl === window.location.origin.replace(/\\/$/, ''); } catch (e) { return false; }\r\n    })();\r\n    const sessionOk = (() => { try { return sessionStorage.getItem('serverUrlReachable') === '1'; } catch (e) { return false; } })();\r\n\r\n    const ctrl = new AbortController();\r\n    const performPost = async () => {\r\n      try {\r\n        const payload = { interval: monitorMinutes, emaShort: monitorEma1, emaLong: monitorEma2, scanType: 'both' };\r\n        const res = await fetch(`${serverUrl}/config`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload), signal: ctrl.signal });\r\n        if (!res.ok) {\r\n          console.warn('[App] /config sync failed', res.status);\r\n        }\r\n      } catch (e) {\r\n        try { console.warn('[App] /config sync error', e); } catch (err) {}\r\n        try { localStorage.removeItem('serverUrl'); } catch (err) {}\r\n        try { showToast('Server URL removed due to network error. Please reload the page.', false); } catch (err) {}\r\n      }\r\n    };\r\n\r\n    const t = setTimeout(async () => {\r\n      // If same-origin or we've seen the server reachable in this session, post immediately.\r\n      if (isSameOrigin || sessionOk) {\r\n        await performPost();\r\n        return;\r\n      }\r\n\r\n      // Otherwise, do a lightweight health check with short timeout. If it succeeds, mark session ok and post.\r\n      let healthOk = false;\r\n      try {\r\n        const healthCtrl = new AbortController();\r\n        const healthTimeout = setTimeout(() => { try { healthCtrl.abort(); } catch (e) {} }, 1500);\r\n        try {\r\n          const hres = await fetch(`${serverUrl.replace(/\\/$/, '')}/health`, { method: 'GET', signal: healthCtrl.signal });\r\n          if (hres && hres.ok) {\r\n            healthOk = true;\r\n            try { sessionStorage.setItem('serverUrlReachable', '1'); } catch (e) {}\r\n          }\r\n        } catch (e) {\r\n          healthOk = false;\r\n        } finally { clearTimeout(healthTimeout); }\r\n      } catch (e) { healthOk = false; }\r\n\r\n      if (healthOk) {\r\n        await performPost();\r\n      } else {\r\n        // Avoid attempting the POST if health check failed — remove runtime override to stop further errors\r\n        try { localStorage.removeItem('serverUrl'); } catch (e) {}\r\n        try { showToast('Server unreachable — cleared configured server URL. Please set a valid server URL.', false); } catch (e) {}\r\n      }\r\n    }, 200);\r\n    return () => { try { ctrl.abort(); } catch (e) {} clearTimeout(t); };\r\n  }, [serverUrl, monitorMinutes, monitorEma1, monitorEma2, showToast]);\r\n\r\n  // Debug helper: simulate a confirmed cross from the frontend (calls /send-alert and adds local event)\r\n  const simulateConfirmedCross = React.useCallback((forceType) => {\r\n    try {\r\n      const type = forceType || (confirmedCross || 'bull');\r\n      const sym = (activeSymbol || symbol || '').toString().replace(/[^A-Za-z0-9]/g, '').toUpperCase();\r\n      const price = lastPrice || 0;\r\n  // Use configured EMA labels (monitorEma1/monitorEma2) in the message text\r\n  const text = `${sym} ${type === 'bull' ? `Bullish EMA${monitorEma1} > EMA${monitorEma2}` : `Bearish EMA${monitorEma1} < EMA${monitorEma2}`} @ ${price}`;\r\n      // add local event\r\n      const ev = { ts: Date.now(), time: new Date().toLocaleString(), type: type === 'bull' ? 'bull' : 'bear', price, symbol: sym, source: 'client-sim' };\r\n      addEvent(ev);\r\n      // fire server send\r\n      (async () => {\r\n        if (!serverUrl) {\r\n          // no server configured (static mode): inform user that Telegram relay is disabled\r\n          try { showToast('Telegram disabled: no server configured', false); } catch (e) {}\r\n          if (showDebug) console.debug('[App] simulateConfirmedCross skipped POST /send-alert because serverUrl is not set');\r\n          return;\r\n        }\r\n        try {\r\n          if (showDebug) console.debug('[App] simulate sending /send-alert', { url: `${serverUrl}/send-alert`, payload: { symbol: sym, price, message: text, emaShort: monitorEma1, emaLong: monitorEma2 } });\r\n          const res = await fetch(`${serverUrl}/send-alert`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ symbol: sym, price, message: text, emaShort: monitorEma1, emaLong: monitorEma2 }) });\r\n          let json = null;\r\n          try { json = await res.json(); } catch (e) { json = null; }\r\n          const sendEv = { ts: Date.now(), time: new Date().toLocaleString(), type: 'telegram_send', symbol: sym, source: 'client-send', ok: res.ok, status: res.status, body: json };\r\n          addEvent(sendEv);\r\n          // show immediate toast to user\r\n          try { showToast(res.ok ? `Telegram send OK (${sym})` : `Telegram send failed (${res.status})`, res.ok); } catch (e) {}\r\n          if (showDebug) console.debug('[App] simulate /send-alert response', sendEv);\r\n        } catch (e) {\r\n          const errEv = { ts: Date.now(), time: new Date().toLocaleString(), type: 'telegram_send', symbol: sym, source: 'client-send', ok: false, error: String(e) };\r\n          addEvent(errEv);\r\n          try { showToast(`Telegram send error: ${String(e)}`, false); } catch (err) {}\r\n          if (showDebug) console.debug('[App] simulate send-alert failed', e);\r\n        }\r\n      })();\r\n    } catch (e) { if (showDebug) console.debug('[App] simulateConfirmedCross error', e); }\r\n  }, [activeSymbol, symbol, lastPrice, addEvent, showDebug, confirmedCross, showToast, serverUrl, monitorEma1, monitorEma2]);\r\n\r\n \r\n\r\n  // Removed SSE subscription: the app runs fully client-side with Pages Functions for Telegram relay.\r\n\r\n  // helper to ask server to monitor a symbol, then connect the client\r\n  const setServerAndConnect = React.useCallback(async (sym, opts) => {\r\n    const q = (sym || '').toString().replace(/[^A-Za-z0-9]/g, '').toUpperCase();\r\n  let interval = (opts && typeof opts.interval !== 'undefined') ? opts.interval : monitorMinutes;\r\n    // normalize interval to a string accepted by Binance (e.g., '5m'). If a plain number is provided, treat as minutes.\r\n    if (typeof interval === 'number' || (typeof interval === 'string' && /^\\d+$/.test(String(interval)))) {\r\n      interval = `${interval}m`;\r\n    }\r\n  const emaShort = (opts && typeof opts.emaShort !== 'undefined') ? opts.emaShort : monitorEma1;\r\n  const emaLong = (opts && typeof opts.emaLong !== 'undefined') ? opts.emaLong : monitorEma2;\r\n  // confirmCandles retained previously for server sync; now unused after backend removal\r\n    if (!q) {\r\n      try { connect(sym); } catch (e) {}\r\n      return;\r\n    }\r\n    // If caller passed monitoring overrides, commit them to parent state so the\r\n    // `useEmaCross` hook receives updated props on next render. We wait a short\r\n    // moment to allow React to flush state before calling `connect` which relies\r\n    // on the hook's `interval`/`emaShort`/`emaLong` values.\r\n    try {\r\n      if (opts) {\r\n        try {\r\n          if (typeof opts.interval !== 'undefined') {\r\n            let v = opts.interval;\r\n            if (typeof v === 'string' && v.endsWith('m')) v = Number(v.replace(/m$/, ''));\r\n            if (typeof v === 'number' && Number.isFinite(v) && v > 0) setMonitorMinutes(Number(v));\r\n          }\r\n        } catch (e) {}\r\n        try { if (typeof opts.emaShort !== 'undefined' && Number.isFinite(Number(opts.emaShort))) setMonitorEma1(Number(opts.emaShort)); } catch (e) {}\r\n        try { if (typeof opts.emaLong !== 'undefined' && Number.isFinite(Number(opts.emaLong))) setMonitorEma2(Number(opts.emaLong)); } catch (e) {}\r\n      }\r\n    } catch (e) {}\r\n\r\n    // allow React to re-render with new monitor values before connecting\r\n    try { await new Promise((r) => setTimeout(r, 120)); } catch (e) {}\r\n\r\n    try { connect(q); } catch (e) {}\r\n    // persist the last-used monitor inputs so Alerts/Controls can restore them\r\n    try {\r\n      const toStore = { monitorMinutes: (typeof interval === 'string' && interval.endsWith('m')) ? Number(interval.replace(/m$/, '')) : Number(interval), monitorEma1: Number(emaShort), monitorEma2: Number(emaLong), lastSymbol: q };\r\n      localStorage.setItem('lastMonitor', JSON.stringify(toStore));\r\n    } catch (e) {}\r\n  }, [connect, monitorMinutes, monitorEma1, monitorEma2]);\r\n\r\n  \r\n\r\n  // 자동 연결: symbol이 유효하고 autoStart가 켜져 있으면 Start 버튼을 누르지 않아도 connect 호출\r\n  useEffect(() => {\r\n    try {\r\n      const q = (symbol || '').replace(/[^A-Za-z0-9]/g, '').toUpperCase();\r\n      // only attempt auto-start after the hook has initialized its EMA seed\r\n      if (q && symbolValid === true && autoStart && status === 'initialized') {\r\n        if (!activeSymbol || activeSymbol.toString().toUpperCase() !== q) {\r\n          // ensure server monitor symbol is updated before connecting\r\n          try { setServerAndConnect(q); } catch (e) { connect(q); }\r\n        }\r\n      }\r\n    } catch (e) {\r\n      // ignore\r\n    }\r\n  }, [symbol, symbolValid, autoStart, activeSymbol, connect, setServerAndConnect, status]);\r\n\r\n  // Removed server /health polling in simplified Pages-only mode\r\n\r\n  // clearAlerts will be handled inline if needed; no export/import UI\r\n\r\n  // --- localStorage에 Alerts 저장/복원 헬퍼 ---\r\n  const ALERTS_LS_KEY = 'alerts';\r\n  function saveAlertsToLocalStorage(arr) {\r\n    try {\r\n      if (!Array.isArray(arr)) return;\r\n      // 저장 크기 제한을 위해 최신 500개(로컬스토리지라 쿠키보다 여유)\r\n      const toStore = JSON.stringify(arr.slice(0, 500));\r\n      localStorage.setItem(ALERTS_LS_KEY, toStore);\r\n    } catch (e) {\r\n      // ignore\r\n    }\r\n  }\r\n\r\n  function loadAlertsFromLocalStorage() {\r\n    try {\r\n      const raw = localStorage.getItem(ALERTS_LS_KEY);\r\n      if (!raw) return null;\r\n      const parsed = JSON.parse(raw);\r\n      if (Array.isArray(parsed)) return parsed;\r\n      return null;\r\n    } catch (e) {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  // 복원: 마운트 시 localStorage에서 alerts 복원 (7일 초과 항목은 제거)\r\n  useEffect(() => {\r\n    try {\r\n      const saved = loadAlertsFromLocalStorage();\r\n      if (saved && Array.isArray(saved) && saved.length > 0) {\r\n        const cutoff = Date.now() - 1000 * 60 * 60 * 24 * 7; // 7 days\r\n        const normTarget = (symbol || '').replace(/[^A-Za-z0-9]/g, '').toUpperCase();\r\n        const filtered = saved.filter((ev) => {\r\n          if (!ev) return false;\r\n          if (typeof ev.ts === 'number' && ev.ts < cutoff) return false;\r\n          // try parse time string as fallback\r\n          if (typeof ev.ts !== 'number') {\r\n            const parsed = Date.parse(ev.time || '');\r\n            if (isNaN(parsed) || parsed < cutoff) return false;\r\n          }\r\n          // require event symbol to match the current selected symbol to avoid showing other-pair alerts\r\n          const evSym = (ev.symbol || '').toString().replace(/[^A-Za-z0-9]/g, '').toUpperCase();\r\n          return evSym === normTarget;\r\n        });\r\n        setEvents(filtered);\r\n      }\r\n    } catch (e) {}\r\n  }, [symbol]);\r\n\r\n  // Persist monitor inputs whenever they change so UI values are remembered\r\n  useEffect(() => {\r\n    try {\r\n      const toStore = { monitorMinutes, monitorEma1, monitorEma2, monitorConfirm, lastSymbol: symbol };\r\n      localStorage.setItem('lastMonitor', JSON.stringify(toStore));\r\n    } catch (e) {}\r\n  }, [monitorMinutes, monitorEma1, monitorEma2, monitorConfirm, symbol]);\r\n\r\n  // 저장: events가 바뀔 때마다 localStorage에 반영 (저장 전에 7일 초과 항목 제거)\r\n  useEffect(() => {\r\n    try {\r\n      const cutoff = Date.now() - 1000 * 60 * 60 * 24 * 7; // 7 days\r\n      const filtered = (events || []).filter((ev) => {\r\n        if (!ev) return false;\r\n        if (typeof ev.ts === 'number') return ev.ts >= cutoff;\r\n        const parsed = Date.parse(ev.time || '');\r\n        if (!isNaN(parsed)) return parsed >= cutoff;\r\n        return false;\r\n      });\r\n      saveAlertsToLocalStorage(filtered);\r\n    } catch (e) {}\r\n  }, [events]);\r\n\r\n  // Alerts 항목 삭제 핸들러 (ts 기반으로 고유 항목 제거)\r\n  function removeAlertByTs(ts) {\r\n    try {\r\n      const next = (events || []).filter((ev) => ev && ev.ts !== ts);\r\n      setEvents(next);\r\n    } catch (e) {}\r\n  }\r\n  \r\n\r\n  // if symbol becomes invalid, disable autoStart and disconnect to avoid wrong subscriptions\r\n  useEffect(() => {\r\n    if (symbolValid === false) {\r\n      if (autoStart) setAutoStart(false);\r\n      // ensure disconnected\r\n      if (connected) disconnect();\r\n    }\r\n    // include dependencies to avoid stale closures\r\n  }, [symbolValid, autoStart, connected, disconnect]);\r\n\r\n  // Ask for notification permission on first user interaction\r\n  useEffect(() => {\r\n    const handle = () => {\r\n      if ('Notification' in window && Notification.permission === 'default') {\r\n        Notification.requestPermission().then(() => {});\r\n      }\r\n      window.removeEventListener('click', handle);\r\n    };\r\n    window.addEventListener('click', handle);\r\n    return () => window.removeEventListener('click', handle);\r\n  }, []);\r\n\r\n  // react to confirmed cross changes and notify (skip initial)\r\n  useEffect(() => {\r\n  if (!confirmedCross) return;\r\n    // If the confirmed signal came from initial seeding, don't notify — treat as seeded state\r\n    if (confirmedSource === 'init') {\r\n      // ensure we don't trigger notification for seed values\r\n      lastNotified.current = confirmedCross;\r\n      return;\r\n    }\r\n    if (lastNotified.current == null) {\r\n      // First observed cross. If it's from initialization source ('init') skip notify.\r\n      // Otherwise (e.g. mock/live source) allow sending alert immediately.\r\n      if (confirmedSource === 'init') {\r\n        lastNotified.current = confirmedCross; // seed only\r\n        return;\r\n      }\r\n      // fall through to notify logic below\r\n    }\r\n\r\n    if (lastNotified.current !== confirmedCross) {\r\n  const type = confirmedCross === 'bull' ? `Bullish EMA${monitorEma1} > EMA${monitorEma2}` : `Bearish EMA${monitorEma1} < EMA${monitorEma2}`;\r\n      const symToShowRaw = activeSymbol || symbol || '';\r\n      const symToShow = (symToShowRaw || '').toString().replace(/[^A-Za-z0-9]/g, '').toUpperCase();\r\n        // Determine the authoritative price to show/send. Prefer closed-candle `lastPrice`,\r\n        // but fall back to the most recent live tick (`lastTick`) when a closed price\r\n        // isn't yet available. Still skip only when this is the initial seeded value.\r\n        const priceToUse = (typeof lastPrice !== 'undefined' && lastPrice !== null) ? lastPrice : ((typeof lastTick !== 'undefined' && lastTick !== null) ? lastTick : null);\r\n        if (confirmedSource === 'init') {\r\n          // do not notify for seed values\r\n          lastNotified.current = confirmedCross;\r\n          return;\r\n        }\r\n        if (priceToUse == null) {\r\n          // If we truly have no price at all, skip but log in debug so user can inspect\r\n          if (showDebug) console.debug('[App] skipping notification: no price available (lastPrice & lastTick are null)', { confirmedCross, confirmedSource, activeSymbol, symbol });\r\n          lastNotified.current = confirmedCross;\r\n          return;\r\n        }\r\n        const body = `${symToShow} ${type} @ ${priceToUse}`;\r\n\r\n      // Also request the server to send a Telegram message for this confirmed cross.\r\n      // In static/client-only mode (no serverUrl) skip server relay and show a toast.\r\n      (async () => {\r\n        if (!serverUrl) {\r\n          try { showToast('Telegram disabled: no server configured', false); } catch (e) {}\r\n          if (showDebug) console.debug('[App] confirmedCross skipped POST /send-alert because serverUrl is not set');\r\n          return;\r\n        }\r\n        // preflight debug\r\n        try { if (showDebug) console.debug('[App] confirmedCross preparing /send-alert', { serverUrl, payloadPreview: { symbol: symToShow, price: priceToUse } }); } catch (e) {}\r\n  const payload = { symbol: symToShow, price: priceToUse, message: type + ' @ ' + priceToUse, emaShort: monitorEma1, emaLong: monitorEma2 };\r\n        // debug: log state used for send-alert so we can trace mismatched alerts\r\n        try {\r\n          console.log('[App] sending /send-alert', { sendSym: symToShow, selectedSymbol: symbol, activeSymbol, confirmedCross, confirmedSource, ema9, ema26, lastPrice, lastTick });\r\n        } catch (e) {}\r\n        // also show a brief UI toast with the same debug info so it's visible without DevTools\r\n        try {\r\n          const dbg = `${symToShow} ${confirmedCross} | active:${activeSymbol || '—'} | ema:${(typeof ema9==='number'?ema9.toFixed(4):'—')}/${(typeof ema26==='number'?ema26.toFixed(4):'—')} | price:${(typeof lastPrice!=='undefined'&&lastPrice!==null)?lastPrice:'—'}`;\r\n          try { showToast(`[DEBUG] ${dbg}`, true); } catch (e) { console.log('[App] showToast debug failed', e); }\r\n        } catch (e) {}\r\n        const maxAttempts = 3;\r\n        let attempt = 0;\r\n        let lastError = null;\r\n        while (attempt < maxAttempts) {\r\n          attempt += 1;\r\n          try {\r\n            if (showDebug) console.debug('[App] confirmedCross sending /send-alert attempt', attempt, payload);\r\n            const res = await fetch(`${serverUrl}/send-alert`, {\r\n              method: 'POST',\r\n              headers: { 'Content-Type': 'application/json' },\r\n              body: JSON.stringify(payload),\r\n            });\r\n            let json = null;\r\n            try { json = await res.json(); } catch (e) { json = null; }\r\n            const sendEv = { ts: Date.now(), time: new Date().toLocaleString(), type: 'telegram_send', symbol: symToShow, source: 'client-confirmed', ok: res.ok, status: res.status, body: json, attempt };\r\n            try { addEvent(sendEv); } catch (e) { setEvents((prev) => [sendEv, ...prev].slice(0, 500)); }\r\n            try { showToast(res.ok ? `Telegram send OK (${symToShow})` : `Telegram send failed (${res.status})`, res.ok); } catch (e) {}\r\n            if (res.ok) break; // success\r\n            lastError = new Error(`HTTP ${res.status}`);\r\n          } catch (e) {\r\n            lastError = e;\r\n            if (showDebug) console.debug('[App] confirmedCross send attempt failed', attempt, e);\r\n          }\r\n          // exponential backoff before retrying\r\n          if (attempt < maxAttempts) {\r\n            const delay = 500 * Math.pow(2, attempt - 1); // 500ms, 1000ms\r\n            await new Promise((r) => setTimeout(r, delay));\r\n          }\r\n        }\r\n        if (lastError && showDebug) console.debug('[App] confirmedCross final send error', lastError);\r\n      })();\r\n\r\n      // browser notification\r\n      if ('Notification' in window && Notification.permission === 'granted') {\r\n        new Notification(type, { body });\r\n      }\r\n\r\n      // Add a lightweight console trace of the cross event for operational debugging\r\n  try { console.log('[App] confirmedCross event', { symbol: symToShow, direction: confirmedCross, price: priceToUse, serverUrl, confirmClosedCandles: monitorConfirm }); } catch (e) {}\r\n\r\n      // beep and log\r\n      beep();\r\n      const evObj = { ts: Date.now(), time: new Date().toLocaleString(), type: confirmedCross, price: lastPrice, symbol: symToShow, source: confirmedSource || 'unknown' };\r\n      if (showDebug) console.debug('[App] created confirmedCross event', evObj);\r\n      setEvents((s) => [evObj, ...s].slice(0, 500));\r\n      lastNotified.current = confirmedCross;\r\n    }\r\n  }, [confirmedCross, lastPrice, lastTick, symbol, activeSymbol, confirmedSource, showDebug, addEvent, showToast, ema9, ema26, serverUrl, monitorEma1, monitorEma2, monitorConfirm]);\r\n\r\n  // 심볼이 바뀔 때 이전 심볼의 알림 상태가 남아 있어 잘못된 알림이 뜨는 문제 방지\r\n  // 심볼을 변경하면 lastNotified를 초기화해서 다음 confirmedCross는 초기 시드로 처리되도록 한다.\r\n  useEffect(() => {\r\n    try {\r\n      lastNotified.current = null;\r\n    } catch (e) {}\r\n    // also clear displayed events when symbol changes to avoid mixing alerts from different symbols\r\n    try { setEvents([]); } catch (e) {}\r\n  }, [symbol]);\r\n\r\n  // persist last selected symbol so the app remembers it between sessions\r\n  useEffect(() => {\r\n    try {\r\n      if (!symbol) return;\r\n      const norm = (symbol || '').toString().replace(/[^A-Za-z0-9]/g, '').toUpperCase();\r\n      localStorage.setItem('lastSymbol', norm);\r\n    } catch (e) {}\r\n  }, [symbol]);\r\n\r\n  // theme (darkMode) persisted in localStorage\r\n  const [darkMode, setDarkMode] = useState(() => { try { return localStorage.getItem('darkMode') === '1'; } catch (e) { return false; } });\r\n  const toggleDark = React.useCallback(() => {\r\n    try {\r\n      setDarkMode((d) => { const next = !d; try { localStorage.setItem('darkMode', next ? '1' : '0'); } catch (e) {} ; return next; });\r\n    } catch (e) {}\r\n  }, []);\r\n\r\n  return (\r\n    <div className={`App ${darkMode ? 'dark' : ''}`}>\r\n  <TopMenu onNavigate={setView} view={view} darkMode={darkMode} toggleDark={toggleDark} />\r\n      <div className=\"container\">\r\n  <div className={`card ${view === 'alerts' ? 'view-alerts' : ''}`}>\r\n              {view === 'scanner' ? (\r\n            <ScannerPage availableSymbols={availableSymbols} fetchExchangeInfo={fetchExchangeInfo} monitorMinutes={monitorMinutes} setMonitorMinutes={setMonitorMinutes} monitorEma1={monitorEma1} setMonitorEma1={setMonitorEma1} monitorEma2={monitorEma2} setMonitorEma2={setMonitorEma2} />\r\n          ) : (\r\n            <>\r\n              <Header />\r\n              {/* inline toast for quick feedback */}\r\n              {toast && (\r\n                <div className={`toast ${toast.ok ? 'toast-ok' : 'toast-err'}`} role=\"status\" aria-live=\"polite\">\r\n                  <div className=\"toast-title\">{toast.ok ? 'Success' : 'Error'}</div>\r\n                  <div className=\"toast-body\">{toast.message}</div>\r\n                </div>\r\n              )}\r\n\r\n              <Controls\r\n                symbol={symbol}\r\n                setSymbol={setSymbol}\r\n                \r\n                symbolValid={symbolValid}\r\n                setSymbolValid={setSymbolValid}\r\n                suggestions={suggestions}\r\n                setSuggestions={setSuggestions}\r\n                availableSymbols={availableSymbols}\r\n                validateSymbolOnce={validateSymbolOnce}\r\n                connect={setServerAndConnect}\r\n                disconnect={disconnect}\r\n                status={status}\r\n                connected={connected}\r\n                // monitoring inputs\r\n                monitorMinutes={monitorMinutes}\r\n                setMonitorMinutes={setMonitorMinutes}\r\n                monitorEma1={monitorEma1}\r\n                setMonitorEma1={setMonitorEma1}\r\n                monitorEma2={monitorEma2}\r\n                setMonitorEma2={setMonitorEma2}\r\n                monitorConfirm={monitorConfirm}\r\n                setMonitorConfirm={setMonitorConfirm}\r\n                // pass serverUrl and toast helper so Controls can manage runtime server setting\r\n                serverUrl={serverUrl}\r\n                showToast={showToast}\r\n              />\r\n              {/* 간단한 로딩 표시: 심볼 변경으로 상태가 reloading일 때 보임 */}\r\n              {status === 'reloading' && (\r\n                <div className=\"loading-text\">초기화 중... 잠시만 기다려주세요</div>\r\n              )}\r\n              {symbolValid === false && (\r\n                <div className=\"invalid-msg\">\r\n                  Invalid symbol — please check the trading pair (e.g. BTCUSDT)\r\n                  {suggestions && suggestions.length > 0 && (\r\n                    <div className=\"suggestions-wrap\">\r\n                      <div className=\"suggestions-title\">Did you mean:</div>\r\n                      <div className=\"suggestions-list\">\r\n                        {suggestions.map((s) => (\r\n                          <button key={s} className=\"suggestion-btn\" onClick={() => {\r\n                            setSymbol(s);\r\n                            setSymbolValid(true);\r\n                            setSuggestions([]);\r\n                            try { if (autoStart) setServerAndConnect(s); } catch (e) {}\r\n                          }}>{s}</button>\r\n                        ))}\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              )}\r\n\r\n              {view === 'debug' ? (\r\n                <DebugPanel availableSymbols={availableSymbols} fetchExchangeInfo={fetchExchangeInfo} showDebug={showDebug} setMarketCheckResult={setMarketCheckResult} marketCheckResult={marketCheckResult} symbol={symbol} onSimulateAlert={simulateConfirmedCross} />\r\n              ) : null}\r\n\r\n              <div className=\"status\">\r\n                Status: <strong>{status}</strong> {connected ? <span className=\"status-connected\">(connected)</span> : <span className=\"status-disconnected\">(disconnected)</span>}\r\n              </div>\r\n\r\n              <Metrics activeSymbol={activeSymbol} symbol={symbol} lastPrice={lastPrice} lastTick={lastTick} lastCandleClosed={lastCandleClosed} cross={cross} confirmedCross={confirmedCross} ema9={ema9} ema26={ema26} monitorEma1={monitorEma1} monitorEma2={monitorEma2} />\r\n\r\n              <Alerts\r\n                events={events}\r\n                removeAlertByTs={removeAlertByTs}\r\n                symbol={symbol}\r\n                symbolValid={symbolValid}\r\n                status={status}\r\n                connect={setServerAndConnect}\r\n                disconnect={disconnect}\r\n                monitorMinutes={monitorMinutes}\r\n                monitorEma1={monitorEma1}\r\n                monitorEma2={monitorEma2}\r\n                monitorConfirm={monitorConfirm}\r\n              />\r\n\r\n              <Notes>Notes: This app uses Binance public REST + websocket. Make sure network allows wss access to stream.binance.com.</Notes>\r\n            </>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default App;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}